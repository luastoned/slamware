{"ast":null,"code":"import _regeneratorRuntime from \"/home/hmnd/code/poetryslam/web-app/node_modules/@babel/runtime/regenerator/index.js\";\n\n/*!\n* rete v1.4.8 \n* (c) 2022 Vitaliy Stoliarov \n* Released under the MIT license.\n*/\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nvar Component = function Component(name) {\n  _classCallCheck(this, Component);\n\n  _defineProperty(this, \"name\", void 0);\n\n  _defineProperty(this, \"data\", {});\n\n  _defineProperty(this, \"engine\", null);\n\n  this.name = name;\n};\n\nvar Node = /*#__PURE__*/function () {\n  function Node(name) {\n    _classCallCheck(this, Node);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"id\", void 0);\n\n    _defineProperty(this, \"position\", [0.0, 0.0]);\n\n    _defineProperty(this, \"inputs\", new Map());\n\n    _defineProperty(this, \"outputs\", new Map());\n\n    _defineProperty(this, \"controls\", new Map());\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"meta\", {});\n\n    this.name = name;\n    this.id = Node.incrementId();\n  }\n\n  _createClass(Node, [{\n    key: \"_add\",\n    value: function _add(list, item, prop) {\n      if (list.has(item.key)) throw new Error(\"Item with key '\".concat(item.key, \"' already been added to the node\"));\n      if (item[prop] !== null) throw new Error('Item has already been added to some node');\n      item[prop] = this;\n      list.set(item.key, item);\n    }\n  }, {\n    key: \"addControl\",\n    value: function addControl(control) {\n      this._add(this.controls, control, 'parent');\n\n      return this;\n    }\n  }, {\n    key: \"removeControl\",\n    value: function removeControl(control) {\n      control.parent = null;\n      this.controls[\"delete\"](control.key);\n    }\n  }, {\n    key: \"addInput\",\n    value: function addInput(input) {\n      this._add(this.inputs, input, 'node');\n\n      return this;\n    }\n  }, {\n    key: \"removeInput\",\n    value: function removeInput(input) {\n      input.removeConnections();\n      input.node = null;\n      this.inputs[\"delete\"](input.key);\n    }\n  }, {\n    key: \"addOutput\",\n    value: function addOutput(output) {\n      this._add(this.outputs, output, 'node');\n\n      return this;\n    }\n  }, {\n    key: \"removeOutput\",\n    value: function removeOutput(output) {\n      output.removeConnections();\n      output.node = null;\n      this.outputs[\"delete\"](output.key);\n    }\n  }, {\n    key: \"setMeta\",\n    value: function setMeta(meta) {\n      this.meta = meta;\n      return this;\n    }\n  }, {\n    key: \"getConnections\",\n    value: function getConnections() {\n      var ios = [].concat(_toConsumableArray(this.inputs.values()), _toConsumableArray(this.outputs.values()));\n      var connections = ios.reduce(function (arr, io) {\n        return [].concat(_toConsumableArray(arr), _toConsumableArray(io.connections));\n      }, []);\n      return connections;\n    }\n  }, {\n    key: \"update\",\n    value: function update() {}\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var reduceIO = function reduceIO(list) {\n        return Array.from(list).reduce(function (obj, _ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              key = _ref2[0],\n              io = _ref2[1];\n\n          obj[key] = io.toJSON();\n          return obj;\n        }, {});\n      };\n\n      return {\n        'id': this.id,\n        'data': this.data,\n        'inputs': reduceIO(this.inputs),\n        'outputs': reduceIO(this.outputs),\n        'position': this.position,\n        'name': this.name\n      };\n    }\n  }], [{\n    key: \"incrementId\",\n    value: function incrementId() {\n      if (!this.latestId) this.latestId = 1;else this.latestId++;\n      return this.latestId;\n    }\n  }, {\n    key: \"resetId\",\n    value: function resetId() {\n      this.latestId = 0;\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      var node = new Node(json.name);\n\n      var _json$position = _slicedToArray(json.position, 2),\n          x = _json$position[0],\n          y = _json$position[1];\n\n      node.id = json.id;\n      node.data = json.data;\n      node.position = [x, y];\n      node.name = json.name;\n      Node.latestId = Math.max(node.id, Node.latestId);\n      return node;\n    }\n  }]);\n\n  return Node;\n}();\n\n_defineProperty(Node, \"latestId\", 0);\n\nvar Component$1 = /*#__PURE__*/function (_ComponentWorker) {\n  _inherits(Component, _ComponentWorker);\n\n  function Component(name) {\n    var _this;\n\n    _classCallCheck(this, Component);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Component).call(this, name));\n\n    _defineProperty(_assertThisInitialized(_this), \"editor\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"data\", {});\n\n    return _this;\n  }\n\n  _createClass(Component, [{\n    key: \"build\",\n    value: function () {\n      var _build = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(node) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.builder(node);\n\n              case 2:\n                return _context.abrupt(\"return\", node);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function build(_x) {\n        return _build.apply(this, arguments);\n      }\n\n      return build;\n    }()\n  }, {\n    key: \"createNode\",\n    value: function () {\n      var _createNode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var data,\n            node,\n            _args2 = arguments;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                data = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n                node = new Node(this.name);\n                node.data = data;\n                _context2.next = 5;\n                return this.build(node);\n\n              case 5:\n                return _context2.abrupt(\"return\", node);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function createNode() {\n        return _createNode.apply(this, arguments);\n      }\n\n      return createNode;\n    }()\n  }]);\n\n  return Component;\n}(Component);\n\nvar Connection = /*#__PURE__*/function () {\n  function Connection(output, input) {\n    _classCallCheck(this, Connection);\n\n    _defineProperty(this, \"output\", void 0);\n\n    _defineProperty(this, \"input\", void 0);\n\n    _defineProperty(this, \"data\", {});\n\n    this.output = output;\n    this.input = input;\n    this.data = {};\n    this.input.addConnection(this);\n  }\n\n  _createClass(Connection, [{\n    key: \"remove\",\n    value: function remove() {\n      this.input.removeConnection(this);\n      this.output.removeConnection(this);\n    }\n  }]);\n\n  return Connection;\n}();\n\nvar Control = /*#__PURE__*/function () {\n  function Control(key) {\n    _classCallCheck(this, Control);\n\n    _defineProperty(this, \"key\", void 0);\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"parent\", null);\n\n    if (this.constructor === Control) throw new TypeError('Can not construct abstract class');\n    if (!key) throw new Error('The key parameter is missing in super() of Control ');\n    this.key = key;\n  }\n\n  _createClass(Control, [{\n    key: \"getNode\",\n    value: function getNode() {\n      if (this.parent === null) throw new Error('Control isn\\'t added to Node/Input');\n      if (this.parent instanceof Node) return this.parent;\n      if (!this.parent.node) throw new Error('Control hasn\\'t be added to Input or Node');\n      return this.parent.node;\n    }\n  }, {\n    key: \"getData\",\n    value: function getData(key) {\n      return this.getNode().data[key];\n    }\n  }, {\n    key: \"putData\",\n    value: function putData(key, data) {\n      this.getNode().data[key] = data;\n    }\n  }]);\n\n  return Control;\n}();\n\nvar Emitter = /*#__PURE__*/function () {\n  function Emitter(events) {\n    _classCallCheck(this, Emitter);\n\n    _defineProperty(this, \"events\", {});\n\n    _defineProperty(this, \"silent\", false);\n\n    this.events = events instanceof Emitter ? events.events : events.handlers;\n  }\n\n  _createClass(Emitter, [{\n    key: \"on\",\n    value: function on(names, handler) {\n      var _this = this;\n\n      var events = names instanceof Array ? names : names.split(' ');\n      events.forEach(function (name) {\n        if (!_this.events[name]) throw new Error(\"The event \".concat(name, \" does not exist\"));\n\n        _this.events[name].push(handler);\n      });\n      return this;\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(name) {\n      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      if (!(name in this.events)) throw new Error(\"The event \".concat(name, \" cannot be triggered\"));\n      return this.events[name].reduce(function (r, e) {\n        return e(params) !== false && r;\n      }, true); // return false if at least one event is false        \n    }\n  }, {\n    key: \"bind\",\n    value: function bind(name) {\n      if (this.events[name]) throw new Error(\"The event \".concat(name, \" is already bound\"));\n      this.events[name] = [];\n    }\n  }, {\n    key: \"exist\",\n    value: function exist(name) {\n      return Array.isArray(this.events[name]);\n    }\n  }]);\n\n  return Emitter;\n}();\n\nvar IO = /*#__PURE__*/function () {\n  function IO(key, name, socket, multiConns) {\n    _classCallCheck(this, IO);\n\n    _defineProperty(this, \"node\", null);\n\n    _defineProperty(this, \"multipleConnections\", void 0);\n\n    _defineProperty(this, \"connections\", []);\n\n    _defineProperty(this, \"key\", void 0);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"socket\", void 0);\n\n    this.node = null;\n    this.multipleConnections = multiConns;\n    this.connections = [];\n    this.key = key;\n    this.name = name;\n    this.socket = socket;\n  }\n\n  _createClass(IO, [{\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      this.connections.splice(this.connections.indexOf(connection), 1);\n    }\n  }, {\n    key: \"removeConnections\",\n    value: function removeConnections() {\n      var _this = this;\n\n      this.connections.forEach(function (connection) {\n        return _this.removeConnection(connection);\n      });\n    }\n  }]);\n\n  return IO;\n}();\n\nvar Input = /*#__PURE__*/function (_IO) {\n  _inherits(Input, _IO);\n\n  function Input(key, title, socket) {\n    var _this;\n\n    var multiConns = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    _classCallCheck(this, Input);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Input).call(this, key, title, socket, multiConns));\n\n    _defineProperty(_assertThisInitialized(_this), \"control\", null);\n\n    return _this;\n  }\n\n  _createClass(Input, [{\n    key: \"hasConnection\",\n    value: function hasConnection() {\n      return this.connections.length > 0;\n    }\n  }, {\n    key: \"addConnection\",\n    value: function addConnection(connection) {\n      if (!this.multipleConnections && this.hasConnection()) throw new Error('Multiple connections not allowed');\n      this.connections.push(connection);\n    }\n  }, {\n    key: \"addControl\",\n    value: function addControl(control) {\n      this.control = control;\n      control.parent = this;\n    }\n  }, {\n    key: \"showControl\",\n    value: function showControl() {\n      return !this.hasConnection() && this.control !== null;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        'connections': this.connections.map(function (c) {\n          if (!c.output.node) throw new Error('Node not added to Output');\n          return {\n            node: c.output.node.id,\n            output: c.output.key,\n            data: c.data\n          };\n        })\n      };\n    }\n  }]);\n\n  return Input;\n}(IO);\n\nvar Validator = /*#__PURE__*/function () {\n  function Validator() {\n    _classCallCheck(this, Validator);\n  }\n\n  _createClass(Validator, null, [{\n    key: \"isValidData\",\n    value: function isValidData(data) {\n      return typeof data.id === 'string' && this.isValidId(data.id) && data.nodes instanceof Object && !(data.nodes instanceof Array);\n    }\n  }, {\n    key: \"isValidId\",\n    value: function isValidId(id) {\n      return /^[\\w-]{3,}@[0-9]+\\.[0-9]+\\.[0-9]+$/.test(id);\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(id, data) {\n      var id1 = id.split('@');\n      var id2 = data.id.split('@');\n      var msg = [];\n      if (!this.isValidData(data)) msg.push('Data is not suitable');\n      if (id !== data.id) msg.push('IDs not equal');\n      if (id1[0] !== id2[0]) msg.push('Names don\\'t match');\n      if (id1[1] !== id2[1]) msg.push('Versions don\\'t match');\n      return {\n        success: Boolean(!msg.length),\n        msg: msg.join('. ')\n      };\n    }\n  }]);\n\n  return Validator;\n}();\n\nvar Context = /*#__PURE__*/function (_Emitter) {\n  _inherits(Context, _Emitter);\n\n  function Context(id, events) {\n    var _this;\n\n    _classCallCheck(this, Context);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Context).call(this, events));\n\n    _defineProperty(_assertThisInitialized(_this), \"id\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"plugins\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"components\", void 0);\n\n    if (!Validator.isValidId(id)) throw new Error('ID should be valid to name@0.1.0 format');\n    _this.id = id;\n    _this.plugins = new Map();\n    _this.components = new Map();\n    return _this;\n  }\n\n  _createClass(Context, [{\n    key: \"use\",\n    value: function use(plugin, options) {\n      if (plugin.name && this.plugins.has(plugin.name)) throw new Error(\"Plugin \".concat(plugin.name, \" already in use\"));\n      plugin.install(this, options || {});\n      this.plugins.set(plugin.name, options);\n    }\n  }, {\n    key: \"register\",\n    value: function register(component) {\n      if (this.components.has(component.name)) throw new Error(\"Component \".concat(component.name, \" already registered\"));\n      this.components.set(component.name, component);\n      this.trigger('componentregister', component);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.trigger('destroy');\n    }\n  }]);\n\n  return Context;\n}(Emitter);\n\nfunction listenWindow(event, handler) {\n  window.addEventListener(event, handler);\n  return function () {\n    window.removeEventListener(event, handler);\n  };\n}\n\nvar Drag = /*#__PURE__*/function () {\n  function Drag(el) {\n    var onTranslate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (_x, _y, _e) {};\n    var onStart = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (_e) {};\n    var onDrag = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_e) {};\n\n    _classCallCheck(this, Drag);\n\n    this.onTranslate = onTranslate;\n    this.onStart = onStart;\n    this.onDrag = onDrag;\n\n    _defineProperty(this, \"pointerStart\", void 0);\n\n    _defineProperty(this, \"el\", void 0);\n\n    _defineProperty(this, \"destroy\", void 0);\n\n    this.pointerStart = null;\n    this.el = el;\n    this.el.style.touchAction = 'none';\n    this.el.addEventListener('pointerdown', this.down.bind(this));\n    var destroyMove = listenWindow('pointermove', this.move.bind(this));\n    var destroyUp = listenWindow('pointerup', this.up.bind(this));\n\n    this.destroy = function () {\n      destroyMove();\n      destroyUp();\n    };\n  }\n\n  _createClass(Drag, [{\n    key: \"down\",\n    value: function down(e) {\n      if (e.pointerType === 'mouse' && e.button !== 0) return;\n      e.stopPropagation();\n      this.pointerStart = [e.pageX, e.pageY];\n      this.onStart(e);\n    }\n  }, {\n    key: \"move\",\n    value: function move(e) {\n      if (!this.pointerStart) return;\n      e.preventDefault();\n      var _ref = [e.pageX, e.pageY],\n          x = _ref[0],\n          y = _ref[1];\n      var delta = [x - this.pointerStart[0], y - this.pointerStart[1]];\n      var zoom = this.el.getBoundingClientRect().width / this.el.offsetWidth;\n      this.onTranslate(delta[0] / zoom, delta[1] / zoom, e);\n    }\n  }, {\n    key: \"up\",\n    value: function up(e) {\n      if (!this.pointerStart) return;\n      this.pointerStart = null;\n      this.onDrag(e);\n    }\n  }]);\n\n  return Drag;\n}();\n\nvar Zoom = /*#__PURE__*/function () {\n  function Zoom(container, el, intensity, onzoom) {\n    _classCallCheck(this, Zoom);\n\n    _defineProperty(this, \"el\", void 0);\n\n    _defineProperty(this, \"intensity\", void 0);\n\n    _defineProperty(this, \"onzoom\", void 0);\n\n    _defineProperty(this, \"previous\", null);\n\n    _defineProperty(this, \"pointers\", []);\n\n    _defineProperty(this, \"destroy\", void 0);\n\n    this.el = el;\n    this.intensity = intensity;\n    this.onzoom = onzoom;\n    container.addEventListener('wheel', this.wheel.bind(this));\n    container.addEventListener('pointerdown', this.down.bind(this));\n    container.addEventListener('dblclick', this.dblclick.bind(this));\n    var destroyMove = listenWindow('pointermove', this.move.bind(this));\n    var destroyUp = listenWindow('pointerup', this.end.bind(this));\n    var destroyCancel = listenWindow('pointercancel', this.end.bind(this));\n\n    this.destroy = function () {\n      destroyMove();\n      destroyUp();\n      destroyCancel();\n    };\n  }\n\n  _createClass(Zoom, [{\n    key: \"wheel\",\n    value: function wheel(e) {\n      e.preventDefault();\n      var rect = this.el.getBoundingClientRect();\n      var isNegative = e.deltaY < 0;\n      var delta = isNegative ? this.intensity : -this.intensity;\n      var ox = (rect.left - e.clientX) * delta;\n      var oy = (rect.top - e.clientY) * delta;\n      this.onzoom(delta, ox, oy, 'wheel');\n    }\n  }, {\n    key: \"touches\",\n    value: function touches() {\n      var e = {\n        touches: this.pointers\n      };\n      var _ref = [e.touches[0].clientX, e.touches[0].clientY],\n          x1 = _ref[0],\n          y1 = _ref[1];\n      var _ref2 = [e.touches[1].clientX, e.touches[1].clientY],\n          x2 = _ref2[0],\n          y2 = _ref2[1];\n      var distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n      return {\n        cx: (x1 + x2) / 2,\n        cy: (y1 + y2) / 2,\n        distance: distance\n      };\n    }\n  }, {\n    key: \"down\",\n    value: function down(e) {\n      this.pointers.push(e);\n    }\n  }, {\n    key: \"move\",\n    value: function move(e) {\n      this.pointers = this.pointers.map(function (p) {\n        return p.pointerId === e.pointerId ? e : p;\n      });\n      if (!this.translating) return;\n      var rect = this.el.getBoundingClientRect();\n\n      var _this$touches = this.touches(),\n          cx = _this$touches.cx,\n          cy = _this$touches.cy,\n          distance = _this$touches.distance;\n\n      if (this.previous !== null) {\n        var delta = distance / this.previous.distance - 1;\n        var ox = (rect.left - cx) * delta;\n        var oy = (rect.top - cy) * delta;\n        this.onzoom(delta, ox - (this.previous.cx - cx), oy - (this.previous.cy - cy), 'touch');\n      }\n\n      this.previous = {\n        cx: cx,\n        cy: cy,\n        distance: distance\n      };\n    }\n  }, {\n    key: \"end\",\n    value: function end(e) {\n      this.previous = null;\n      this.pointers = this.pointers.filter(function (p) {\n        return p.pointerId !== e.pointerId;\n      });\n    }\n  }, {\n    key: \"dblclick\",\n    value: function dblclick(e) {\n      e.preventDefault();\n      var rect = this.el.getBoundingClientRect();\n      var delta = 4 * this.intensity;\n      var ox = (rect.left - e.clientX) * delta;\n      var oy = (rect.top - e.clientY) * delta;\n      this.onzoom(delta, ox, oy, 'dblclick');\n    }\n  }, {\n    key: \"translating\",\n    get: function get() {\n      // is translating while zoom (works on multitouch)\n      return this.pointers.length >= 2;\n    }\n  }]);\n\n  return Zoom;\n}();\n\nvar Area = /*#__PURE__*/function (_Emitter) {\n  _inherits(Area, _Emitter);\n\n  function Area(container, emitter) {\n    var _this;\n\n    _classCallCheck(this, Area);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Area).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"container\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"transform\", {\n      k: 1,\n      x: 0,\n      y: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"mouse\", {\n      x: 0,\n      y: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_startPosition\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"_zoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_drag\", void 0);\n\n    var el = _this.el = document.createElement('div');\n    _this.container = container;\n    el.style.transformOrigin = '0 0';\n    _this._zoom = new Zoom(container, el, 0.1, _this.onZoom.bind(_assertThisInitialized(_this)));\n    _this._drag = new Drag(container, _this.onTranslate.bind(_assertThisInitialized(_this)), _this.onStart.bind(_assertThisInitialized(_this)));\n    emitter.on('destroy', function () {\n      _this._zoom.destroy();\n\n      _this._drag.destroy();\n    });\n\n    _this.container.addEventListener('pointermove', _this.pointermove.bind(_assertThisInitialized(_this)));\n\n    _this.update();\n\n    return _this;\n  }\n\n  _createClass(Area, [{\n    key: \"update\",\n    value: function update() {\n      var t = this.transform;\n      this.el.style.transform = \"translate(\".concat(t.x, \"px, \").concat(t.y, \"px) scale(\").concat(t.k, \")\");\n    }\n  }, {\n    key: \"pointermove\",\n    value: function pointermove(e) {\n      var clientX = e.clientX,\n          clientY = e.clientY;\n      var rect = this.el.getBoundingClientRect();\n      var x = clientX - rect.left;\n      var y = clientY - rect.top;\n      var k = this.transform.k;\n      this.mouse = {\n        x: x / k,\n        y: y / k\n      };\n      this.trigger('mousemove', _objectSpread({}, this.mouse)); // TODO rename on `pointermove`\n    }\n  }, {\n    key: \"onStart\",\n    value: function onStart() {\n      this._startPosition = _objectSpread({}, this.transform);\n    }\n  }, {\n    key: \"onTranslate\",\n    value: function onTranslate(dx, dy) {\n      if (this._zoom.translating) return; // lock translation while zoom on multitouch\n\n      if (this._startPosition) this.translate(this._startPosition.x + dx, this._startPosition.y + dy);\n    }\n  }, {\n    key: \"onZoom\",\n    value: function onZoom(delta, ox, oy, source) {\n      this.zoom(this.transform.k * (1 + delta), ox, oy, source);\n      this.update();\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(x, y) {\n      var params = {\n        transform: this.transform,\n        x: x,\n        y: y\n      };\n      if (!this.trigger('translate', params)) return;\n      this.transform.x = params.x;\n      this.transform.y = params.y;\n      this.update();\n      this.trigger('translated');\n    }\n  }, {\n    key: \"zoom\",\n    value: function zoom(_zoom) {\n      var ox = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var oy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var source = arguments.length > 3 ? arguments[3] : undefined;\n      var k = this.transform.k;\n      var params = {\n        transform: this.transform,\n        zoom: _zoom,\n        source: source\n      };\n      if (!this.trigger('zoom', params)) return;\n      var d = (k - params.zoom) / (k - _zoom || 1);\n      this.transform.k = params.zoom || 1;\n      this.transform.x += ox * d;\n      this.transform.y += oy * d;\n      this.update();\n      this.trigger('zoomed', {\n        source: source\n      });\n    }\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(el) {\n      this.el.appendChild(el);\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(el) {\n      this.el.removeChild(el);\n    }\n  }]);\n\n  return Area;\n}(Emitter);\n\nvar ConnectionView = /*#__PURE__*/function (_Emitter) {\n  _inherits(ConnectionView, _Emitter);\n\n  function ConnectionView(connection, inputNode, outputNode, emitter) {\n    var _this;\n\n    _classCallCheck(this, ConnectionView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ConnectionView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"connection\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"inputNode\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"outputNode\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _this.connection = connection;\n    _this.inputNode = inputNode;\n    _this.outputNode = outputNode;\n    _this.el = document.createElement('div');\n    _this.el.style.position = 'absolute';\n    _this.el.style.zIndex = '-1';\n\n    _this.trigger('renderconnection', {\n      el: _this.el,\n      connection: _this.connection,\n      points: _this.getPoints()\n    });\n\n    return _this;\n  }\n\n  _createClass(ConnectionView, [{\n    key: \"getPoints\",\n    value: function getPoints() {\n      var _this$outputNode$getS = this.outputNode.getSocketPosition(this.connection.output),\n          _this$outputNode$getS2 = _slicedToArray(_this$outputNode$getS, 2),\n          x1 = _this$outputNode$getS2[0],\n          y1 = _this$outputNode$getS2[1];\n\n      var _this$inputNode$getSo = this.inputNode.getSocketPosition(this.connection.input),\n          _this$inputNode$getSo2 = _slicedToArray(_this$inputNode$getSo, 2),\n          x2 = _this$inputNode$getSo2[0],\n          y2 = _this$inputNode$getSo2[1];\n\n      return [x1, y1, x2, y2];\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      this.trigger('updateconnection', {\n        el: this.el,\n        connection: this.connection,\n        points: this.getPoints()\n      });\n    }\n  }]);\n\n  return ConnectionView;\n}(Emitter);\n\nvar ControlView = /*#__PURE__*/function (_Emitter) {\n  _inherits(ControlView, _Emitter);\n\n  function ControlView(el, control, emitter) {\n    var _this;\n\n    _classCallCheck(this, ControlView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ControlView).call(this, emitter));\n\n    _this.trigger('rendercontrol', {\n      el: el,\n      control: control\n    });\n\n    return _this;\n  }\n\n  return ControlView;\n}(Emitter);\n\nvar SocketView = /*#__PURE__*/function (_Emitter) {\n  _inherits(SocketView, _Emitter);\n\n  function SocketView(el, type, io, node, emitter) {\n    var _this$trigger;\n\n    var _this;\n\n    _classCallCheck(this, SocketView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SocketView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"type\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"io\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"node\", void 0);\n\n    _this.el = el;\n    _this.type = type;\n    _this.io = io;\n    _this.node = node;\n\n    _this.trigger('rendersocket', (_this$trigger = {\n      el: el\n    }, _defineProperty(_this$trigger, type, _this.io), _defineProperty(_this$trigger, \"socket\", io.socket), _this$trigger));\n\n    return _this;\n  }\n\n  _createClass(SocketView, [{\n    key: \"getPosition\",\n    value: function getPosition(_ref) {\n      var position = _ref.position;\n      var el = this.el;\n      return [position[0] + el.offsetLeft + el.offsetWidth / 2, position[1] + el.offsetTop + el.offsetHeight / 2];\n    }\n  }]);\n\n  return SocketView;\n}(Emitter);\n\nvar NodeView = /*#__PURE__*/function (_Emitter) {\n  _inherits(NodeView, _Emitter);\n\n  function NodeView(node, component, emitter) {\n    var _this;\n\n    _classCallCheck(this, NodeView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NodeView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"node\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"component\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"sockets\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"controls\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_startPosition\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"_drag\", void 0);\n\n    _this.node = node;\n    _this.component = component;\n    _this.el = document.createElement('div');\n    _this.el.style.position = 'absolute';\n\n    _this.el.addEventListener('contextmenu', function (e) {\n      return _this.trigger('contextmenu', {\n        e: e,\n        node: _this.node\n      });\n    });\n\n    _this._drag = new Drag(_this.el, _this.onTranslate.bind(_assertThisInitialized(_this)), _this.onSelect.bind(_assertThisInitialized(_this)), function () {\n      _this.trigger('nodedraged', node);\n\n      _this.trigger('nodedragged', node);\n    });\n\n    _this.trigger('rendernode', {\n      el: _this.el,\n      node: node,\n      component: component.data,\n      bindSocket: _this.bindSocket.bind(_assertThisInitialized(_this)),\n      bindControl: _this.bindControl.bind(_assertThisInitialized(_this))\n    });\n\n    _this.update();\n\n    return _this;\n  }\n\n  _createClass(NodeView, [{\n    key: \"clearSockets\",\n    value: function clearSockets() {\n      var _this2 = this;\n\n      var ios = [].concat(_toConsumableArray(this.node.inputs.values()), _toConsumableArray(this.node.outputs.values()));\n      this.sockets.forEach(function (s) {\n        if (!ios.includes(s.io)) _this2.sockets[\"delete\"](s.io);\n      });\n    }\n  }, {\n    key: \"bindSocket\",\n    value: function bindSocket(el, type, io) {\n      this.clearSockets();\n      this.sockets.set(io, new SocketView(el, type, io, this.node, this));\n    }\n  }, {\n    key: \"bindControl\",\n    value: function bindControl(el, control) {\n      this.controls.set(control, new ControlView(el, control, this));\n    }\n  }, {\n    key: \"getSocketPosition\",\n    value: function getSocketPosition(io) {\n      var socket = this.sockets.get(io);\n      if (!socket) throw new Error(\"Socket not found for \".concat(io.name, \" with key \").concat(io.key));\n      return socket.getPosition(this.node);\n    }\n  }, {\n    key: \"onSelect\",\n    value: function onSelect(e) {\n      var payload = {\n        node: this.node,\n        accumulate: e.ctrlKey,\n        e: e\n      };\n      this.onStart();\n      this.trigger('multiselectnode', payload);\n      this.trigger('selectnode', payload);\n    }\n  }, {\n    key: \"onStart\",\n    value: function onStart() {\n      this._startPosition = _toConsumableArray(this.node.position);\n    }\n  }, {\n    key: \"onTranslate\",\n    value: function onTranslate(dx, dy) {\n      this.trigger('translatenode', {\n        node: this.node,\n        dx: dx,\n        dy: dy\n      });\n    }\n  }, {\n    key: \"onDrag\",\n    value: function onDrag(dx, dy) {\n      var x = this._startPosition[0] + dx;\n      var y = this._startPosition[1] + dy;\n      this.translate(x, y);\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(x, y) {\n      var node = this.node;\n      var params = {\n        node: node,\n        x: x,\n        y: y\n      };\n      if (!this.trigger('nodetranslate', params)) return;\n\n      var _node$position = _slicedToArray(node.position, 2),\n          px = _node$position[0],\n          py = _node$position[1];\n\n      var prev = [px, py];\n      node.position[0] = params.x;\n      node.position[1] = params.y;\n      this.update();\n      this.trigger('nodetranslated', {\n        node: node,\n        prev: prev\n      });\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var _this$node$position = _slicedToArray(this.node.position, 2),\n          x = _this$node$position[0],\n          y = _this$node$position[1];\n\n      this.el.style.transform = \"translate(\".concat(x, \"px, \").concat(y, \"px)\");\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {}\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._drag.destroy();\n    }\n  }]);\n\n  return NodeView;\n}(Emitter);\n\nvar EditorView = /*#__PURE__*/function (_Emitter) {\n  _inherits(EditorView, _Emitter);\n\n  function EditorView(container, components, emitter) {\n    var _this;\n\n    _classCallCheck(this, EditorView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditorView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"container\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"components\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"nodes\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"connections\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"area\", void 0);\n\n    _this.container = container;\n    _this.components = components;\n    _this.container.style.overflow = 'hidden';\n\n    _this.container.addEventListener('click', _this.click.bind(_assertThisInitialized(_this)));\n\n    _this.container.addEventListener('contextmenu', function (e) {\n      return _this.trigger('contextmenu', {\n        e: e,\n        view: _assertThisInitialized(_this)\n      });\n    });\n\n    emitter.on('destroy', listenWindow('resize', _this.resize.bind(_assertThisInitialized(_this))));\n    emitter.on('destroy', function () {\n      return _this.nodes.forEach(function (view) {\n        return view.destroy();\n      });\n    });\n\n    _this.on('nodetranslated', _this.updateConnections.bind(_assertThisInitialized(_this)));\n\n    _this.area = new Area(container, _assertThisInitialized(_this));\n\n    _this.container.appendChild(_this.area.el);\n\n    return _this;\n  }\n\n  _createClass(EditorView, [{\n    key: \"addNode\",\n    value: function addNode(node) {\n      var component = this.components.get(node.name);\n      if (!component) throw new Error(\"Component \".concat(node.name, \" not found\"));\n      var nodeView = new NodeView(node, component, this);\n      this.nodes.set(node, nodeView);\n      this.area.appendChild(nodeView.el);\n    }\n  }, {\n    key: \"removeNode\",\n    value: function removeNode(node) {\n      var nodeView = this.nodes.get(node);\n      this.nodes[\"delete\"](node);\n\n      if (nodeView) {\n        this.area.removeChild(nodeView.el);\n        nodeView.destroy();\n      }\n    }\n  }, {\n    key: \"addConnection\",\n    value: function addConnection(connection) {\n      if (!connection.input.node || !connection.output.node) throw new Error('Connection input or output not added to node');\n      var viewInput = this.nodes.get(connection.input.node);\n      var viewOutput = this.nodes.get(connection.output.node);\n      if (!viewInput || !viewOutput) throw new Error('View node not found for input or output');\n      var connView = new ConnectionView(connection, viewInput, viewOutput, this);\n      this.connections.set(connection, connView);\n      this.area.appendChild(connView.el);\n    }\n  }, {\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      var connView = this.connections.get(connection);\n      this.connections[\"delete\"](connection);\n      if (connView) this.area.removeChild(connView.el);\n    }\n  }, {\n    key: \"updateConnections\",\n    value: function updateConnections(_ref) {\n      var _this2 = this;\n\n      var node = _ref.node;\n      node.getConnections().forEach(function (conn) {\n        var connView = _this2.connections.get(conn);\n\n        if (!connView) throw new Error('Connection view not found');\n        connView.update();\n      });\n    }\n  }, {\n    key: \"resize\",\n    value: function resize() {\n      var container = this.container;\n      if (!container.parentElement) throw new Error('Container doesn\\'t have parent element');\n      var width = container.parentElement.clientWidth;\n      var height = container.parentElement.clientHeight;\n      container.style.width = width + 'px';\n      container.style.height = height + 'px';\n    }\n  }, {\n    key: \"click\",\n    value: function click(e) {\n      var container = this.container;\n      if (container !== e.target) return;\n      if (!this.trigger('click', {\n        e: e,\n        container: container\n      })) return;\n    }\n  }]);\n\n  return EditorView;\n}(Emitter);\n\nvar Selected = /*#__PURE__*/function () {\n  function Selected() {\n    _classCallCheck(this, Selected);\n\n    _defineProperty(this, \"list\", []);\n  }\n\n  _createClass(Selected, [{\n    key: \"add\",\n    value: function add(item) {\n      var accumulate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!accumulate) this.list = [item];else if (!this.contains(item)) this.list.push(item);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.list = [];\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(item) {\n      this.list.splice(this.list.indexOf(item), 1);\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(item) {\n      return this.list.indexOf(item) !== -1;\n    }\n  }, {\n    key: \"each\",\n    value: function each(callback) {\n      this.list.forEach(callback);\n    }\n  }]);\n\n  return Selected;\n}();\n\nvar Events = function Events(handlers) {\n  _classCallCheck(this, Events);\n\n  _defineProperty(this, \"handlers\", void 0);\n\n  this.handlers = _objectSpread({\n    warn: [console.warn],\n    error: [console.error],\n    componentregister: [],\n    destroy: []\n  }, handlers);\n};\n\nvar EditorEvents = /*#__PURE__*/function (_Events) {\n  _inherits(EditorEvents, _Events);\n\n  function EditorEvents() {\n    _classCallCheck(this, EditorEvents);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EditorEvents).call(this, {\n      nodecreate: [],\n      nodecreated: [],\n      noderemove: [],\n      noderemoved: [],\n      connectioncreate: [],\n      connectioncreated: [],\n      connectionremove: [],\n      connectionremoved: [],\n      translatenode: [],\n      nodetranslate: [],\n      nodetranslated: [],\n      nodedraged: [],\n      nodedragged: [],\n      selectnode: [],\n      multiselectnode: [],\n      nodeselect: [],\n      nodeselected: [],\n      rendernode: [],\n      rendersocket: [],\n      rendercontrol: [],\n      renderconnection: [],\n      updateconnection: [],\n      keydown: [],\n      keyup: [],\n      translate: [],\n      translated: [],\n      zoom: [],\n      zoomed: [],\n      click: [],\n      mousemove: [],\n      contextmenu: [],\n      \"import\": [],\n      \"export\": [],\n      process: [],\n      clear: []\n    }));\n  }\n\n  return EditorEvents;\n}(Events);\n\nvar NodeEditor = /*#__PURE__*/function (_Context) {\n  _inherits(NodeEditor, _Context);\n\n  function NodeEditor(id, container) {\n    var _this;\n\n    _classCallCheck(this, NodeEditor);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NodeEditor).call(this, id, new EditorEvents()));\n\n    _defineProperty(_assertThisInitialized(_this), \"nodes\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"selected\", new Selected());\n\n    _defineProperty(_assertThisInitialized(_this), \"view\", void 0);\n\n    _this.view = new EditorView(container, _this.components, _assertThisInitialized(_this));\n\n    _this.on('destroy', listenWindow('keydown', function (e) {\n      return _this.trigger('keydown', e);\n    }));\n\n    _this.on('destroy', listenWindow('keyup', function (e) {\n      return _this.trigger('keyup', e);\n    }));\n\n    _this.on('selectnode', function (_ref) {\n      var node = _ref.node,\n          accumulate = _ref.accumulate;\n      return _this.selectNode(node, accumulate);\n    });\n\n    _this.on('nodeselected', function () {\n      return _this.selected.each(function (n) {\n        var nodeView = _this.view.nodes.get(n);\n\n        nodeView && nodeView.onStart();\n      });\n    });\n\n    _this.on('translatenode', function (_ref2) {\n      var dx = _ref2.dx,\n          dy = _ref2.dy;\n      return _this.selected.each(function (n) {\n        var nodeView = _this.view.nodes.get(n);\n\n        nodeView && nodeView.onDrag(dx, dy);\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(NodeEditor, [{\n    key: \"addNode\",\n    value: function addNode(node) {\n      if (!this.trigger('nodecreate', node)) return;\n      this.nodes.push(node);\n      this.view.addNode(node);\n      this.trigger('nodecreated', node);\n    }\n  }, {\n    key: \"removeNode\",\n    value: function removeNode(node) {\n      var _this2 = this;\n\n      if (!this.trigger('noderemove', node)) return;\n      node.getConnections().forEach(function (c) {\n        return _this2.removeConnection(c);\n      });\n      this.nodes.splice(this.nodes.indexOf(node), 1);\n      this.view.removeNode(node);\n      this.trigger('noderemoved', node);\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(output, input) {\n      var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      if (!this.trigger('connectioncreate', {\n        output: output,\n        input: input\n      })) return;\n\n      try {\n        var connection = output.connectTo(input);\n        connection.data = data;\n        this.view.addConnection(connection);\n        this.trigger('connectioncreated', connection);\n      } catch (e) {\n        this.trigger('warn', e);\n      }\n    }\n  }, {\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      if (!this.trigger('connectionremove', connection)) return;\n      this.view.removeConnection(connection);\n      connection.remove();\n      this.trigger('connectionremoved', connection);\n    }\n  }, {\n    key: \"selectNode\",\n    value: function selectNode(node) {\n      var accumulate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (this.nodes.indexOf(node) === -1) throw new Error('Node not exist in list');\n      if (!this.trigger('nodeselect', node)) return;\n      this.selected.add(node, accumulate);\n      this.trigger('nodeselected', node);\n    }\n  }, {\n    key: \"getComponent\",\n    value: function getComponent(name) {\n      var component = this.components.get(name);\n      if (!component) throw \"Component \".concat(name, \" not found\");\n      return component;\n    }\n  }, {\n    key: \"register\",\n    value: function register(component) {\n      _get(_getPrototypeOf(NodeEditor.prototype), \"register\", this).call(this, component);\n\n      component.editor = this;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var _this3 = this;\n\n      _toConsumableArray(this.nodes).forEach(function (node) {\n        return _this3.removeNode(node);\n      });\n\n      this.trigger('clear');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var data = {\n        id: this.id,\n        nodes: {}\n      };\n      this.nodes.forEach(function (node) {\n        return data.nodes[node.id] = node.toJSON();\n      });\n      this.trigger('export', data);\n      return data;\n    }\n  }, {\n    key: \"beforeImport\",\n    value: function beforeImport(json) {\n      var checking = Validator.validate(this.id, json);\n\n      if (!checking.success) {\n        this.trigger('warn', checking.msg);\n        return false;\n      }\n\n      this.silent = true;\n      this.clear();\n      this.trigger('import', json);\n      return true;\n    }\n  }, {\n    key: \"afterImport\",\n    value: function afterImport() {\n      this.silent = false;\n      return true;\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function () {\n      var _fromJSON = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(json) {\n        var _this4 = this;\n\n        var nodes;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.beforeImport(json)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", false);\n\n              case 2:\n                nodes = {};\n                _context2.prev = 3;\n                _context2.next = 6;\n                return Promise.all(Object.keys(json.nodes).map( /*#__PURE__*/function () {\n                  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n                    var node, component;\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            node = json.nodes[id];\n                            component = _this4.getComponent(node.name);\n                            _context.next = 4;\n                            return component.build(Node.fromJSON(node));\n\n                          case 4:\n                            nodes[id] = _context.sent;\n\n                            _this4.addNode(nodes[id]);\n\n                          case 6:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  return function (_x2) {\n                    return _ref3.apply(this, arguments);\n                  };\n                }()));\n\n              case 6:\n                Object.keys(json.nodes).forEach(function (id) {\n                  var jsonNode = json.nodes[id];\n                  var node = nodes[id];\n                  Object.keys(jsonNode.outputs).forEach(function (key) {\n                    var outputJson = jsonNode.outputs[key];\n                    outputJson.connections.forEach(function (jsonConnection) {\n                      var nodeId = jsonConnection.node;\n                      var data = jsonConnection.data;\n                      var targetOutput = node.outputs.get(key);\n                      var targetInput = nodes[nodeId].inputs.get(jsonConnection.input);\n\n                      if (!targetOutput || !targetInput) {\n                        return _this4.trigger('error', \"IO not found for node \".concat(node.id));\n                      }\n\n                      _this4.connect(targetOutput, targetInput, data);\n                    });\n                  });\n                });\n                _context2.next = 13;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](3);\n                this.trigger('warn', _context2.t0);\n                return _context2.abrupt(\"return\", !this.afterImport());\n\n              case 13:\n                return _context2.abrupt(\"return\", this.afterImport());\n\n              case 14:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[3, 9]]);\n      }));\n\n      function fromJSON(_x) {\n        return _fromJSON.apply(this, arguments);\n      }\n\n      return fromJSON;\n    }()\n  }]);\n\n  return NodeEditor;\n}(Context);\n\nvar Output = /*#__PURE__*/function (_IO) {\n  _inherits(Output, _IO);\n\n  function Output(key, title, socket) {\n    var multiConns = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n    _classCallCheck(this, Output);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Output).call(this, key, title, socket, multiConns));\n  }\n\n  _createClass(Output, [{\n    key: \"hasConnection\",\n    value: function hasConnection() {\n      return this.connections.length > 0;\n    }\n  }, {\n    key: \"connectTo\",\n    value: function connectTo(input) {\n      if (!this.socket.compatibleWith(input.socket)) throw new Error('Sockets not compatible');\n      if (!input.multipleConnections && input.hasConnection()) throw new Error('Input already has one connection');\n      if (!this.multipleConnections && this.hasConnection()) throw new Error('Output already has one connection');\n      var connection = new Connection(this, input);\n      this.connections.push(connection);\n      return connection;\n    }\n  }, {\n    key: \"connectedTo\",\n    value: function connectedTo(input) {\n      return this.connections.some(function (item) {\n        return item.input === input;\n      });\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        'connections': this.connections.map(function (c) {\n          if (!c.input.node) throw new Error('Node not added to Input');\n          return {\n            node: c.input.node.id,\n            input: c.input.key,\n            data: c.data\n          };\n        })\n      };\n    }\n  }]);\n\n  return Output;\n}(IO);\n\nvar Socket = /*#__PURE__*/function () {\n  function Socket(name) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Socket);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"compatible\", []);\n\n    this.name = name;\n    this.data = data;\n    this.compatible = [];\n  }\n\n  _createClass(Socket, [{\n    key: \"combineWith\",\n    value: function combineWith(socket) {\n      this.compatible.push(socket);\n    }\n  }, {\n    key: \"compatibleWith\",\n    value: function compatibleWith(socket) {\n      return this === socket || this.compatible.includes(socket);\n    }\n  }]);\n\n  return Socket;\n}();\n\nfunction intersect(array1, array2) {\n  return array1.filter(function (value) {\n    return -1 !== array2.indexOf(value);\n  });\n}\n\nvar Recursion = /*#__PURE__*/function () {\n  function Recursion(nodes) {\n    _classCallCheck(this, Recursion);\n\n    _defineProperty(this, \"nodes\", void 0);\n\n    this.nodes = nodes;\n  }\n\n  _createClass(Recursion, [{\n    key: \"extractInputNodes\",\n    value: function extractInputNodes(node) {\n      var _this = this;\n\n      return Object.keys(node.inputs).reduce(function (acc, key) {\n        var connections = node.inputs[key].connections;\n        var nodesData = (connections || []).reduce(function (b, c) {\n          return [].concat(_toConsumableArray(b), [_this.nodes[c.node]]);\n        }, []);\n        return [].concat(_toConsumableArray(acc), _toConsumableArray(nodesData));\n      }, []);\n    }\n  }, {\n    key: \"findSelf\",\n    value: function findSelf(list, inputNodes) {\n      var inters = intersect(list, inputNodes);\n      if (inters.length) return inters[0];\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = inputNodes[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var node = _step.value;\n          var l = [node].concat(_toConsumableArray(list));\n          var inter = this.findSelf(l, this.extractInputNodes(node));\n          if (inter) return inter;\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"detect\",\n    value: function detect() {\n      var _this2 = this;\n\n      var nodesArr = Object.keys(this.nodes).map(function (id) {\n        return _this2.nodes[id];\n      });\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = nodesArr[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var node = _step2.value;\n          var inters = this.findSelf([node], this.extractInputNodes(node));\n          if (inters) return inters;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n            _iterator2[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return Recursion;\n}();\n\nvar State = {\n  AVAILABLE: 0,\n  PROCESSED: 1,\n  ABORT: 2\n};\n\nvar EngineEvents = /*#__PURE__*/function (_Events) {\n  _inherits(EngineEvents, _Events);\n\n  function EngineEvents() {\n    _classCallCheck(this, EngineEvents);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EngineEvents).call(this, {}));\n  }\n\n  return EngineEvents;\n}(Events);\n\nvar Engine = /*#__PURE__*/function (_Context) {\n  _inherits(Engine, _Context);\n\n  function Engine(id) {\n    var _this;\n\n    _classCallCheck(this, Engine);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Engine).call(this, id, new EngineEvents()));\n\n    _defineProperty(_assertThisInitialized(_this), \"args\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"data\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", State.AVAILABLE);\n\n    _defineProperty(_assertThisInitialized(_this), \"forwarded\", new Set());\n\n    _defineProperty(_assertThisInitialized(_this), \"onAbort\", function () {});\n\n    return _this;\n  }\n\n  _createClass(Engine, [{\n    key: \"clone\",\n    value: function clone() {\n      var engine = new Engine(this.id);\n      this.components.forEach(function (c) {\n        return engine.register(c);\n      });\n      return engine;\n    }\n  }, {\n    key: \"throwError\",\n    value: function () {\n      var _throwError = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(message) {\n        var data,\n            _args = arguments;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = _args.length > 1 && _args[1] !== undefined ? _args[1] : null;\n                _context.next = 3;\n                return this.abort();\n\n              case 3:\n                this.trigger('error', {\n                  message: message,\n                  data: data\n                });\n                this.processDone();\n                return _context.abrupt(\"return\", 'error');\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function throwError(_x) {\n        return _throwError.apply(this, arguments);\n      }\n\n      return throwError;\n    }()\n  }, {\n    key: \"processStart\",\n    value: function processStart() {\n      if (this.state === State.AVAILABLE) {\n        this.state = State.PROCESSED;\n        return true;\n      }\n\n      if (this.state === State.ABORT) {\n        return false;\n      }\n\n      console.warn(\"The process is busy and has not been restarted.\\n                Use abort() to force it to complete\");\n      return false;\n    }\n  }, {\n    key: \"processDone\",\n    value: function processDone() {\n      var success = this.state !== State.ABORT;\n      this.state = State.AVAILABLE;\n\n      if (!success) {\n        this.onAbort();\n\n        this.onAbort = function () {};\n      }\n\n      return success;\n    }\n  }, {\n    key: \"abort\",\n    value: function () {\n      var _abort = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", new Promise(function (ret) {\n                  if (_this2.state === State.PROCESSED) {\n                    _this2.state = State.ABORT;\n                    _this2.onAbort = ret;\n                  } else if (_this2.state === State.ABORT) {\n                    _this2.onAbort();\n\n                    _this2.onAbort = ret;\n                  } else ret();\n                }));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function abort() {\n        return _abort.apply(this, arguments);\n      }\n\n      return abort;\n    }()\n  }, {\n    key: \"lock\",\n    value: function () {\n      var _lock = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(node) {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", new Promise(function (res) {\n                  node.unlockPool = node.unlockPool || [];\n                  if (node.busy && !node.outputData) node.unlockPool.push(res);else res();\n                  node.busy = true;\n                }));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function lock(_x2) {\n        return _lock.apply(this, arguments);\n      }\n\n      return lock;\n    }()\n  }, {\n    key: \"unlock\",\n    value: function unlock(node) {\n      node.unlockPool.forEach(function (a) {\n        return a();\n      });\n      node.unlockPool = [];\n      node.busy = false;\n    }\n  }, {\n    key: \"extractInputData\",\n    value: function () {\n      var _extractInputData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(node) {\n        var _this3 = this;\n\n        var obj, _i, _Object$keys, key, input, conns, connData;\n\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                obj = {};\n                _i = 0, _Object$keys = Object.keys(node.inputs);\n\n              case 2:\n                if (!(_i < _Object$keys.length)) {\n                  _context5.next = 13;\n                  break;\n                }\n\n                key = _Object$keys[_i];\n                input = node.inputs[key];\n                conns = input.connections;\n                _context5.next = 8;\n                return Promise.all(conns.map( /*#__PURE__*/function () {\n                  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(c) {\n                    var prevNode, outputs;\n                    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            prevNode = _this3.data.nodes[c.node];\n                            _context4.next = 3;\n                            return _this3.processNode(prevNode);\n\n                          case 3:\n                            outputs = _context4.sent;\n\n                            if (outputs) {\n                              _context4.next = 8;\n                              break;\n                            }\n\n                            _this3.abort();\n\n                            _context4.next = 9;\n                            break;\n\n                          case 8:\n                            return _context4.abrupt(\"return\", outputs[c.output]);\n\n                          case 9:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x4) {\n                    return _ref.apply(this, arguments);\n                  };\n                }()));\n\n              case 8:\n                connData = _context5.sent;\n                obj[key] = connData;\n\n              case 10:\n                _i++;\n                _context5.next = 2;\n                break;\n\n              case 13:\n                return _context5.abrupt(\"return\", obj);\n\n              case 14:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function extractInputData(_x3) {\n        return _extractInputData.apply(this, arguments);\n      }\n\n      return extractInputData;\n    }()\n  }, {\n    key: \"processWorker\",\n    value: function () {\n      var _processWorker = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(node) {\n        var inputData, component, outputData;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.extractInputData(node);\n\n              case 2:\n                inputData = _context6.sent;\n                component = this.components.get(node.name);\n                outputData = {};\n                _context6.prev = 5;\n                _context6.next = 8;\n                return component.worker.apply(component, [node, inputData, outputData].concat(_toConsumableArray(this.args)));\n\n              case 8:\n                _context6.next = 14;\n                break;\n\n              case 10:\n                _context6.prev = 10;\n                _context6.t0 = _context6[\"catch\"](5);\n                this.abort();\n                this.trigger('warn', _context6.t0);\n\n              case 14:\n                return _context6.abrupt(\"return\", outputData);\n\n              case 15:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[5, 10]]);\n      }));\n\n      function processWorker(_x5) {\n        return _processWorker.apply(this, arguments);\n      }\n\n      return processWorker;\n    }()\n  }, {\n    key: \"processNode\",\n    value: function () {\n      var _processNode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(node) {\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!(this.state === State.ABORT || !node)) {\n                  _context7.next = 2;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", null);\n\n              case 2:\n                _context7.next = 4;\n                return this.lock(node);\n\n              case 4:\n                if (node.outputData) {\n                  _context7.next = 8;\n                  break;\n                }\n\n                _context7.next = 7;\n                return this.processWorker(node);\n\n              case 7:\n                node.outputData = _context7.sent;\n\n              case 8:\n                this.unlock(node);\n                return _context7.abrupt(\"return\", node.outputData);\n\n              case 10:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function processNode(_x6) {\n        return _processNode.apply(this, arguments);\n      }\n\n      return processNode;\n    }()\n  }, {\n    key: \"forwardProcess\",\n    value: function () {\n      var _forwardProcess = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(node) {\n        var _this4 = this;\n\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                if (!(this.state === State.ABORT)) {\n                  _context10.next = 2;\n                  break;\n                }\n\n                return _context10.abrupt(\"return\", null);\n\n              case 2:\n                _context10.next = 4;\n                return Promise.all(Object.keys(node.outputs).map( /*#__PURE__*/function () {\n                  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(key) {\n                    var output;\n                    return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            output = node.outputs[key];\n                            _context9.next = 3;\n                            return Promise.all(output.connections.map( /*#__PURE__*/function () {\n                              var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(c) {\n                                var nextNode;\n                                return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                                  while (1) {\n                                    switch (_context8.prev = _context8.next) {\n                                      case 0:\n                                        nextNode = _this4.data.nodes[c.node];\n\n                                        if (_this4.forwarded.has(nextNode)) {\n                                          _context8.next = 7;\n                                          break;\n                                        }\n\n                                        _this4.forwarded.add(nextNode);\n\n                                        _context8.next = 5;\n                                        return _this4.processNode(nextNode);\n\n                                      case 5:\n                                        _context8.next = 7;\n                                        return _this4.forwardProcess(nextNode);\n\n                                      case 7:\n                                      case \"end\":\n                                        return _context8.stop();\n                                    }\n                                  }\n                                }, _callee8);\n                              }));\n\n                              return function (_x9) {\n                                return _ref3.apply(this, arguments);\n                              };\n                            }()));\n\n                          case 3:\n                            return _context9.abrupt(\"return\", _context9.sent);\n\n                          case 4:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n\n                  return function (_x8) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }()));\n\n              case 4:\n                return _context10.abrupt(\"return\", _context10.sent);\n\n              case 5:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function forwardProcess(_x7) {\n        return _forwardProcess.apply(this, arguments);\n      }\n\n      return forwardProcess;\n    }()\n  }, {\n    key: \"copy\",\n    value: function copy(data) {\n      data = Object.assign({}, data);\n      data.nodes = Object.assign({}, data.nodes);\n      Object.keys(data.nodes).forEach(function (key) {\n        data.nodes[key] = Object.assign({}, data.nodes[key]);\n      });\n      return data;\n    }\n  }, {\n    key: \"validate\",\n    value: function () {\n      var _validate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(data) {\n        var checking, recursion, recurrentNode;\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                checking = Validator.validate(this.id, data);\n                recursion = new Recursion(data.nodes);\n\n                if (checking.success) {\n                  _context11.next = 6;\n                  break;\n                }\n\n                _context11.next = 5;\n                return this.throwError(checking.msg);\n\n              case 5:\n                return _context11.abrupt(\"return\", _context11.sent);\n\n              case 6:\n                recurrentNode = recursion.detect();\n\n                if (!recurrentNode) {\n                  _context11.next = 11;\n                  break;\n                }\n\n                _context11.next = 10;\n                return this.throwError('Recursion detected', recurrentNode);\n\n              case 10:\n                return _context11.abrupt(\"return\", _context11.sent);\n\n              case 11:\n                return _context11.abrupt(\"return\", true);\n\n              case 12:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function validate(_x10) {\n        return _validate.apply(this, arguments);\n      }\n\n      return validate;\n    }()\n  }, {\n    key: \"processStartNode\",\n    value: function () {\n      var _processStartNode = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12(id) {\n        var startNode;\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (id) {\n                  _context12.next = 2;\n                  break;\n                }\n\n                return _context12.abrupt(\"return\");\n\n              case 2:\n                startNode = this.data.nodes[id];\n\n                if (startNode) {\n                  _context12.next = 7;\n                  break;\n                }\n\n                _context12.next = 6;\n                return this.throwError('Node with such id not found');\n\n              case 6:\n                return _context12.abrupt(\"return\", _context12.sent);\n\n              case 7:\n                _context12.next = 9;\n                return this.processNode(startNode);\n\n              case 9:\n                _context12.next = 11;\n                return this.forwardProcess(startNode);\n\n              case 11:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function processStartNode(_x11) {\n        return _processStartNode.apply(this, arguments);\n      }\n\n      return processStartNode;\n    }()\n  }, {\n    key: \"processUnreachable\",\n    value: function () {\n      var _processUnreachable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n        var data, i, node;\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                data = this.data;\n                _context13.t0 = _regeneratorRuntime.keys(data.nodes);\n\n              case 2:\n                if ((_context13.t1 = _context13.t0()).done) {\n                  _context13.next = 12;\n                  break;\n                }\n\n                i = _context13.t1.value; // process nodes that have not been reached\n\n                node = data.nodes[i];\n\n                if (!(typeof node.outputData === 'undefined')) {\n                  _context13.next = 10;\n                  break;\n                }\n\n                _context13.next = 8;\n                return this.processNode(node);\n\n              case 8:\n                _context13.next = 10;\n                return this.forwardProcess(node);\n\n              case 10:\n                _context13.next = 2;\n                break;\n\n              case 12:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function processUnreachable() {\n        return _processUnreachable.apply(this, arguments);\n      }\n\n      return processUnreachable;\n    }()\n  }, {\n    key: \"process\",\n    value: function () {\n      var _process = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(data) {\n        var startId,\n            _len,\n            args,\n            _key,\n            _args14 = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                startId = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : null;\n\n                if (this.processStart()) {\n                  _context14.next = 3;\n                  break;\n                }\n\n                return _context14.abrupt(\"return\");\n\n              case 3:\n                if (this.validate(data)) {\n                  _context14.next = 5;\n                  break;\n                }\n\n                return _context14.abrupt(\"return\");\n\n              case 5:\n                this.data = this.copy(data);\n\n                for (_len = _args14.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n                  args[_key - 2] = _args14[_key];\n                }\n\n                this.args = args;\n                this.forwarded = new Set();\n                _context14.next = 11;\n                return this.processStartNode(startId);\n\n              case 11:\n                _context14.next = 13;\n                return this.processUnreachable();\n\n              case 13:\n                return _context14.abrupt(\"return\", this.processDone() ? 'success' : 'aborted');\n\n              case 14:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function process(_x12) {\n        return _process.apply(this, arguments);\n      }\n\n      return process;\n    }()\n  }]);\n\n  return Engine;\n}(Context);\n\nvar index = {\n  Engine: Engine,\n  Recursion: Recursion,\n  Component: Component$1,\n  Control: Control,\n  Connection: Connection,\n  Emitter: Emitter,\n  Input: Input,\n  IO: IO,\n  Node: Node,\n  NodeEditor: NodeEditor,\n  Output: Output,\n  Socket: Socket\n};\nexport default index;\nexport { Component$1 as Component, Connection, Control, Emitter, Engine, IO, Input, Node, NodeEditor, Output, Recursion, Socket };","map":{"version":3,"sources":["/home/hmnd/code/poetryslam/web-app/node_modules/rete/build/rete.esm.js"],"names":["asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","value","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","protoProps","staticProps","prototype","_defineProperty","obj","_objectSpread","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_inherits","subClass","superClass","create","constructor","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_assertThisInitialized","ReferenceError","_possibleConstructorReturn","call","_superPropBase","object","property","hasOwnProperty","_get","receiver","Reflect","get","base","desc","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","arr2","iter","Symbol","iterator","toString","from","_arr","_n","_d","_e","_i","_s","next","push","Component","name","Node","Map","id","incrementId","_add","list","item","prop","has","Error","set","addControl","control","controls","removeControl","parent","addInput","input","inputs","removeInput","removeConnections","node","addOutput","output","outputs","removeOutput","setMeta","meta","getConnections","ios","values","connections","reduce","io","update","toJSON","reduceIO","_ref","_ref2","data","position","latestId","resetId","fromJSON","json","_json$position","x","y","Math","max","Component$1","_ComponentWorker","_this","_build","mark","_callee","wrap","_callee$","_context","prev","builder","abrupt","stop","build","_x","_createNode","_callee2","_args2","_callee2$","_context2","createNode","Connection","addConnection","remove","removeConnection","Control","getNode","getData","putData","Emitter","events","handlers","on","names","handler","split","trigger","params","r","e","bind","exist","IO","socket","multiConns","multipleConnections","connection","splice","indexOf","Input","_IO","title","hasConnection","showControl","map","c","Validator","isValidData","isValidId","nodes","test","validate","id1","id2","msg","success","Boolean","join","Context","_Emitter","plugins","components","use","plugin","options","install","register","component","destroy","listenWindow","event","window","addEventListener","removeEventListener","Drag","el","onTranslate","_y","onStart","onDrag","pointerStart","style","touchAction","down","destroyMove","move","destroyUp","up","pointerType","button","stopPropagation","pageX","pageY","preventDefault","delta","zoom","getBoundingClientRect","width","offsetWidth","Zoom","container","intensity","onzoom","wheel","dblclick","end","destroyCancel","rect","isNegative","deltaY","ox","left","clientX","oy","top","clientY","touches","pointers","x1","y1","x2","y2","distance","sqrt","pow","cx","cy","pointerId","translating","_this$touches","previous","Area","emitter","k","document","createElement","transformOrigin","_zoom","onZoom","_drag","pointermove","t","transform","mouse","_startPosition","dx","dy","translate","d","appendChild","removeChild","ConnectionView","inputNode","outputNode","zIndex","points","getPoints","_this$outputNode$getS","getSocketPosition","_this$outputNode$getS2","_this$inputNode$getSo","_this$inputNode$getSo2","ControlView","SocketView","type","_this$trigger","getPosition","offsetLeft","offsetTop","offsetHeight","NodeView","onSelect","bindSocket","bindControl","clearSockets","_this2","sockets","s","includes","payload","accumulate","ctrlKey","_node$position","px","py","_this$node$position","EditorView","overflow","click","view","resize","updateConnections","area","addNode","nodeView","removeNode","viewInput","viewOutput","connView","conn","parentElement","clientWidth","height","clientHeight","Selected","add","contains","clear","each","callback","Events","warn","console","componentregister","EditorEvents","_Events","nodecreate","nodecreated","noderemove","noderemoved","connectioncreate","connectioncreated","connectionremove","connectionremoved","translatenode","nodetranslate","nodetranslated","nodedraged","nodedragged","selectnode","multiselectnode","nodeselect","nodeselected","rendernode","rendersocket","rendercontrol","renderconnection","updateconnection","keydown","keyup","translated","zoomed","mousemove","contextmenu","process","NodeEditor","_Context","selectNode","selected","n","connect","connectTo","getComponent","editor","_this3","beforeImport","checking","silent","afterImport","_fromJSON","_this4","all","_ref3","sent","_x2","jsonNode","outputJson","jsonConnection","nodeId","targetOutput","targetInput","t0","Output","compatibleWith","connectedTo","some","Socket","compatible","combineWith","intersect","array1","array2","Recursion","extractInputNodes","acc","nodesData","b","findSelf","inputNodes","inters","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","l","inter","detect","nodesArr","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","State","AVAILABLE","PROCESSED","ABORT","EngineEvents","Engine","Set","clone","engine","_throwError","message","_args","abort","processDone","throwError","processStart","state","onAbort","_abort","ret","_lock","_callee3","_callee3$","_context3","res","unlockPool","busy","outputData","lock","unlock","a","_extractInputData","_callee5","_Object$keys","conns","connData","_callee5$","_context5","_callee4","prevNode","_callee4$","_context4","processNode","_x4","extractInputData","_x3","_processWorker","_callee6","inputData","_callee6$","_context6","worker","processWorker","_x5","_processNode","_callee7","_callee7$","_context7","_x6","_forwardProcess","_callee10","_callee10$","_context10","_callee9","_callee9$","_context9","_callee8","nextNode","_callee8$","_context8","forwarded","forwardProcess","_x9","_x8","_x7","copy","assign","_validate","_callee11","recursion","recurrentNode","_callee11$","_context11","_x10","_processStartNode","_callee12","startNode","_callee12$","_context12","processStartNode","_x11","_processUnreachable","_callee13","_callee13$","_context13","t1","processUnreachable","_process","_callee14","startId","_len","_key","_args14","_callee14$","_context14","_x12","index"],"mappings":"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","sourcesContent":["/*!\n* rete v1.4.8 \n* (c) 2022 Vitaliy Stoliarov \n* Released under the MIT license.\n*/\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = _getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    _get = Reflect.get;\n  } else {\n    _get = function _get(target, property, receiver) {\n      var base = _superPropBase(target, property);\n\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nvar Component = function Component(name) {\n  _classCallCheck(this, Component);\n\n  _defineProperty(this, \"name\", void 0);\n\n  _defineProperty(this, \"data\", {});\n\n  _defineProperty(this, \"engine\", null);\n\n  this.name = name;\n};\n\nvar Node =\n/*#__PURE__*/\nfunction () {\n  function Node(name) {\n    _classCallCheck(this, Node);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"id\", void 0);\n\n    _defineProperty(this, \"position\", [0.0, 0.0]);\n\n    _defineProperty(this, \"inputs\", new Map());\n\n    _defineProperty(this, \"outputs\", new Map());\n\n    _defineProperty(this, \"controls\", new Map());\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"meta\", {});\n\n    this.name = name;\n    this.id = Node.incrementId();\n  }\n\n  _createClass(Node, [{\n    key: \"_add\",\n    value: function _add(list, item, prop) {\n      if (list.has(item.key)) throw new Error(\"Item with key '\".concat(item.key, \"' already been added to the node\"));\n      if (item[prop] !== null) throw new Error('Item has already been added to some node');\n      item[prop] = this;\n      list.set(item.key, item);\n    }\n  }, {\n    key: \"addControl\",\n    value: function addControl(control) {\n      this._add(this.controls, control, 'parent');\n\n      return this;\n    }\n  }, {\n    key: \"removeControl\",\n    value: function removeControl(control) {\n      control.parent = null;\n      this.controls[\"delete\"](control.key);\n    }\n  }, {\n    key: \"addInput\",\n    value: function addInput(input) {\n      this._add(this.inputs, input, 'node');\n\n      return this;\n    }\n  }, {\n    key: \"removeInput\",\n    value: function removeInput(input) {\n      input.removeConnections();\n      input.node = null;\n      this.inputs[\"delete\"](input.key);\n    }\n  }, {\n    key: \"addOutput\",\n    value: function addOutput(output) {\n      this._add(this.outputs, output, 'node');\n\n      return this;\n    }\n  }, {\n    key: \"removeOutput\",\n    value: function removeOutput(output) {\n      output.removeConnections();\n      output.node = null;\n      this.outputs[\"delete\"](output.key);\n    }\n  }, {\n    key: \"setMeta\",\n    value: function setMeta(meta) {\n      this.meta = meta;\n      return this;\n    }\n  }, {\n    key: \"getConnections\",\n    value: function getConnections() {\n      var ios = [].concat(_toConsumableArray(this.inputs.values()), _toConsumableArray(this.outputs.values()));\n      var connections = ios.reduce(function (arr, io) {\n        return [].concat(_toConsumableArray(arr), _toConsumableArray(io.connections));\n      }, []);\n      return connections;\n    }\n  }, {\n    key: \"update\",\n    value: function update() {}\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var reduceIO = function reduceIO(list) {\n        return Array.from(list).reduce(function (obj, _ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              key = _ref2[0],\n              io = _ref2[1];\n\n          obj[key] = io.toJSON();\n          return obj;\n        }, {});\n      };\n\n      return {\n        'id': this.id,\n        'data': this.data,\n        'inputs': reduceIO(this.inputs),\n        'outputs': reduceIO(this.outputs),\n        'position': this.position,\n        'name': this.name\n      };\n    }\n  }], [{\n    key: \"incrementId\",\n    value: function incrementId() {\n      if (!this.latestId) this.latestId = 1;else this.latestId++;\n      return this.latestId;\n    }\n  }, {\n    key: \"resetId\",\n    value: function resetId() {\n      this.latestId = 0;\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function fromJSON(json) {\n      var node = new Node(json.name);\n\n      var _json$position = _slicedToArray(json.position, 2),\n          x = _json$position[0],\n          y = _json$position[1];\n\n      node.id = json.id;\n      node.data = json.data;\n      node.position = [x, y];\n      node.name = json.name;\n      Node.latestId = Math.max(node.id, Node.latestId);\n      return node;\n    }\n  }]);\n\n  return Node;\n}();\n\n_defineProperty(Node, \"latestId\", 0);\n\nvar Component$1 =\n/*#__PURE__*/\nfunction (_ComponentWorker) {\n  _inherits(Component, _ComponentWorker);\n\n  function Component(name) {\n    var _this;\n\n    _classCallCheck(this, Component);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Component).call(this, name));\n\n    _defineProperty(_assertThisInitialized(_this), \"editor\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"data\", {});\n\n    return _this;\n  }\n\n  _createClass(Component, [{\n    key: \"build\",\n    value: function () {\n      var _build = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(node) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.builder(node);\n\n              case 2:\n                return _context.abrupt(\"return\", node);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function build(_x) {\n        return _build.apply(this, arguments);\n      }\n\n      return build;\n    }()\n  }, {\n    key: \"createNode\",\n    value: function () {\n      var _createNode = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var data,\n            node,\n            _args2 = arguments;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                data = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n                node = new Node(this.name);\n                node.data = data;\n                _context2.next = 5;\n                return this.build(node);\n\n              case 5:\n                return _context2.abrupt(\"return\", node);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function createNode() {\n        return _createNode.apply(this, arguments);\n      }\n\n      return createNode;\n    }()\n  }]);\n\n  return Component;\n}(Component);\n\nvar Connection =\n/*#__PURE__*/\nfunction () {\n  function Connection(output, input) {\n    _classCallCheck(this, Connection);\n\n    _defineProperty(this, \"output\", void 0);\n\n    _defineProperty(this, \"input\", void 0);\n\n    _defineProperty(this, \"data\", {});\n\n    this.output = output;\n    this.input = input;\n    this.data = {};\n    this.input.addConnection(this);\n  }\n\n  _createClass(Connection, [{\n    key: \"remove\",\n    value: function remove() {\n      this.input.removeConnection(this);\n      this.output.removeConnection(this);\n    }\n  }]);\n\n  return Connection;\n}();\n\nvar Control =\n/*#__PURE__*/\nfunction () {\n  function Control(key) {\n    _classCallCheck(this, Control);\n\n    _defineProperty(this, \"key\", void 0);\n\n    _defineProperty(this, \"data\", {});\n\n    _defineProperty(this, \"parent\", null);\n\n    if (this.constructor === Control) throw new TypeError('Can not construct abstract class');\n    if (!key) throw new Error('The key parameter is missing in super() of Control ');\n    this.key = key;\n  }\n\n  _createClass(Control, [{\n    key: \"getNode\",\n    value: function getNode() {\n      if (this.parent === null) throw new Error('Control isn\\'t added to Node/Input');\n      if (this.parent instanceof Node) return this.parent;\n      if (!this.parent.node) throw new Error('Control hasn\\'t be added to Input or Node');\n      return this.parent.node;\n    }\n  }, {\n    key: \"getData\",\n    value: function getData(key) {\n      return this.getNode().data[key];\n    }\n  }, {\n    key: \"putData\",\n    value: function putData(key, data) {\n      this.getNode().data[key] = data;\n    }\n  }]);\n\n  return Control;\n}();\n\nvar Emitter =\n/*#__PURE__*/\nfunction () {\n  function Emitter(events) {\n    _classCallCheck(this, Emitter);\n\n    _defineProperty(this, \"events\", {});\n\n    _defineProperty(this, \"silent\", false);\n\n    this.events = events instanceof Emitter ? events.events : events.handlers;\n  }\n\n  _createClass(Emitter, [{\n    key: \"on\",\n    value: function on(names, handler) {\n      var _this = this;\n\n      var events = names instanceof Array ? names : names.split(' ');\n      events.forEach(function (name) {\n        if (!_this.events[name]) throw new Error(\"The event \".concat(name, \" does not exist\"));\n\n        _this.events[name].push(handler);\n      });\n      return this;\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(name) {\n      var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      if (!(name in this.events)) throw new Error(\"The event \".concat(name, \" cannot be triggered\"));\n      return this.events[name].reduce(function (r, e) {\n        return e(params) !== false && r;\n      }, true); // return false if at least one event is false        \n    }\n  }, {\n    key: \"bind\",\n    value: function bind(name) {\n      if (this.events[name]) throw new Error(\"The event \".concat(name, \" is already bound\"));\n      this.events[name] = [];\n    }\n  }, {\n    key: \"exist\",\n    value: function exist(name) {\n      return Array.isArray(this.events[name]);\n    }\n  }]);\n\n  return Emitter;\n}();\n\nvar IO =\n/*#__PURE__*/\nfunction () {\n  function IO(key, name, socket, multiConns) {\n    _classCallCheck(this, IO);\n\n    _defineProperty(this, \"node\", null);\n\n    _defineProperty(this, \"multipleConnections\", void 0);\n\n    _defineProperty(this, \"connections\", []);\n\n    _defineProperty(this, \"key\", void 0);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"socket\", void 0);\n\n    this.node = null;\n    this.multipleConnections = multiConns;\n    this.connections = [];\n    this.key = key;\n    this.name = name;\n    this.socket = socket;\n  }\n\n  _createClass(IO, [{\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      this.connections.splice(this.connections.indexOf(connection), 1);\n    }\n  }, {\n    key: \"removeConnections\",\n    value: function removeConnections() {\n      var _this = this;\n\n      this.connections.forEach(function (connection) {\n        return _this.removeConnection(connection);\n      });\n    }\n  }]);\n\n  return IO;\n}();\n\nvar Input =\n/*#__PURE__*/\nfunction (_IO) {\n  _inherits(Input, _IO);\n\n  function Input(key, title, socket) {\n    var _this;\n\n    var multiConns = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n\n    _classCallCheck(this, Input);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Input).call(this, key, title, socket, multiConns));\n\n    _defineProperty(_assertThisInitialized(_this), \"control\", null);\n\n    return _this;\n  }\n\n  _createClass(Input, [{\n    key: \"hasConnection\",\n    value: function hasConnection() {\n      return this.connections.length > 0;\n    }\n  }, {\n    key: \"addConnection\",\n    value: function addConnection(connection) {\n      if (!this.multipleConnections && this.hasConnection()) throw new Error('Multiple connections not allowed');\n      this.connections.push(connection);\n    }\n  }, {\n    key: \"addControl\",\n    value: function addControl(control) {\n      this.control = control;\n      control.parent = this;\n    }\n  }, {\n    key: \"showControl\",\n    value: function showControl() {\n      return !this.hasConnection() && this.control !== null;\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        'connections': this.connections.map(function (c) {\n          if (!c.output.node) throw new Error('Node not added to Output');\n          return {\n            node: c.output.node.id,\n            output: c.output.key,\n            data: c.data\n          };\n        })\n      };\n    }\n  }]);\n\n  return Input;\n}(IO);\n\nvar Validator =\n/*#__PURE__*/\nfunction () {\n  function Validator() {\n    _classCallCheck(this, Validator);\n  }\n\n  _createClass(Validator, null, [{\n    key: \"isValidData\",\n    value: function isValidData(data) {\n      return typeof data.id === 'string' && this.isValidId(data.id) && data.nodes instanceof Object && !(data.nodes instanceof Array);\n    }\n  }, {\n    key: \"isValidId\",\n    value: function isValidId(id) {\n      return /^[\\w-]{3,}@[0-9]+\\.[0-9]+\\.[0-9]+$/.test(id);\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(id, data) {\n      var id1 = id.split('@');\n      var id2 = data.id.split('@');\n      var msg = [];\n      if (!this.isValidData(data)) msg.push('Data is not suitable');\n      if (id !== data.id) msg.push('IDs not equal');\n      if (id1[0] !== id2[0]) msg.push('Names don\\'t match');\n      if (id1[1] !== id2[1]) msg.push('Versions don\\'t match');\n      return {\n        success: Boolean(!msg.length),\n        msg: msg.join('. ')\n      };\n    }\n  }]);\n\n  return Validator;\n}();\n\nvar Context =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(Context, _Emitter);\n\n  function Context(id, events) {\n    var _this;\n\n    _classCallCheck(this, Context);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Context).call(this, events));\n\n    _defineProperty(_assertThisInitialized(_this), \"id\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"plugins\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"components\", void 0);\n\n    if (!Validator.isValidId(id)) throw new Error('ID should be valid to name@0.1.0 format');\n    _this.id = id;\n    _this.plugins = new Map();\n    _this.components = new Map();\n    return _this;\n  }\n\n  _createClass(Context, [{\n    key: \"use\",\n    value: function use(plugin, options) {\n      if (plugin.name && this.plugins.has(plugin.name)) throw new Error(\"Plugin \".concat(plugin.name, \" already in use\"));\n      plugin.install(this, options || {});\n      this.plugins.set(plugin.name, options);\n    }\n  }, {\n    key: \"register\",\n    value: function register(component) {\n      if (this.components.has(component.name)) throw new Error(\"Component \".concat(component.name, \" already registered\"));\n      this.components.set(component.name, component);\n      this.trigger('componentregister', component);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.trigger('destroy');\n    }\n  }]);\n\n  return Context;\n}(Emitter);\n\nfunction listenWindow(event, handler) {\n  window.addEventListener(event, handler);\n  return function () {\n    window.removeEventListener(event, handler);\n  };\n}\n\nvar Drag =\n/*#__PURE__*/\nfunction () {\n  function Drag(el) {\n    var onTranslate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (_x, _y, _e) {};\n    var onStart = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (_e) {};\n    var onDrag = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : function (_e) {};\n\n    _classCallCheck(this, Drag);\n\n    this.onTranslate = onTranslate;\n    this.onStart = onStart;\n    this.onDrag = onDrag;\n\n    _defineProperty(this, \"pointerStart\", void 0);\n\n    _defineProperty(this, \"el\", void 0);\n\n    _defineProperty(this, \"destroy\", void 0);\n\n    this.pointerStart = null;\n    this.el = el;\n    this.el.style.touchAction = 'none';\n    this.el.addEventListener('pointerdown', this.down.bind(this));\n    var destroyMove = listenWindow('pointermove', this.move.bind(this));\n    var destroyUp = listenWindow('pointerup', this.up.bind(this));\n\n    this.destroy = function () {\n      destroyMove();\n      destroyUp();\n    };\n  }\n\n  _createClass(Drag, [{\n    key: \"down\",\n    value: function down(e) {\n      if (e.pointerType === 'mouse' && e.button !== 0) return;\n      e.stopPropagation();\n      this.pointerStart = [e.pageX, e.pageY];\n      this.onStart(e);\n    }\n  }, {\n    key: \"move\",\n    value: function move(e) {\n      if (!this.pointerStart) return;\n      e.preventDefault();\n      var _ref = [e.pageX, e.pageY],\n          x = _ref[0],\n          y = _ref[1];\n      var delta = [x - this.pointerStart[0], y - this.pointerStart[1]];\n      var zoom = this.el.getBoundingClientRect().width / this.el.offsetWidth;\n      this.onTranslate(delta[0] / zoom, delta[1] / zoom, e);\n    }\n  }, {\n    key: \"up\",\n    value: function up(e) {\n      if (!this.pointerStart) return;\n      this.pointerStart = null;\n      this.onDrag(e);\n    }\n  }]);\n\n  return Drag;\n}();\n\nvar Zoom =\n/*#__PURE__*/\nfunction () {\n  function Zoom(container, el, intensity, onzoom) {\n    _classCallCheck(this, Zoom);\n\n    _defineProperty(this, \"el\", void 0);\n\n    _defineProperty(this, \"intensity\", void 0);\n\n    _defineProperty(this, \"onzoom\", void 0);\n\n    _defineProperty(this, \"previous\", null);\n\n    _defineProperty(this, \"pointers\", []);\n\n    _defineProperty(this, \"destroy\", void 0);\n\n    this.el = el;\n    this.intensity = intensity;\n    this.onzoom = onzoom;\n    container.addEventListener('wheel', this.wheel.bind(this));\n    container.addEventListener('pointerdown', this.down.bind(this));\n    container.addEventListener('dblclick', this.dblclick.bind(this));\n    var destroyMove = listenWindow('pointermove', this.move.bind(this));\n    var destroyUp = listenWindow('pointerup', this.end.bind(this));\n    var destroyCancel = listenWindow('pointercancel', this.end.bind(this));\n\n    this.destroy = function () {\n      destroyMove();\n      destroyUp();\n      destroyCancel();\n    };\n  }\n\n  _createClass(Zoom, [{\n    key: \"wheel\",\n    value: function wheel(e) {\n      e.preventDefault();\n      var rect = this.el.getBoundingClientRect();\n      var isNegative = e.deltaY < 0;\n      var delta = isNegative ? this.intensity : -this.intensity;\n      var ox = (rect.left - e.clientX) * delta;\n      var oy = (rect.top - e.clientY) * delta;\n      this.onzoom(delta, ox, oy, 'wheel');\n    }\n  }, {\n    key: \"touches\",\n    value: function touches() {\n      var e = {\n        touches: this.pointers\n      };\n      var _ref = [e.touches[0].clientX, e.touches[0].clientY],\n          x1 = _ref[0],\n          y1 = _ref[1];\n      var _ref2 = [e.touches[1].clientX, e.touches[1].clientY],\n          x2 = _ref2[0],\n          y2 = _ref2[1];\n      var distance = Math.sqrt(Math.pow(x1 - x2, 2) + Math.pow(y1 - y2, 2));\n      return {\n        cx: (x1 + x2) / 2,\n        cy: (y1 + y2) / 2,\n        distance: distance\n      };\n    }\n  }, {\n    key: \"down\",\n    value: function down(e) {\n      this.pointers.push(e);\n    }\n  }, {\n    key: \"move\",\n    value: function move(e) {\n      this.pointers = this.pointers.map(function (p) {\n        return p.pointerId === e.pointerId ? e : p;\n      });\n      if (!this.translating) return;\n      var rect = this.el.getBoundingClientRect();\n\n      var _this$touches = this.touches(),\n          cx = _this$touches.cx,\n          cy = _this$touches.cy,\n          distance = _this$touches.distance;\n\n      if (this.previous !== null) {\n        var delta = distance / this.previous.distance - 1;\n        var ox = (rect.left - cx) * delta;\n        var oy = (rect.top - cy) * delta;\n        this.onzoom(delta, ox - (this.previous.cx - cx), oy - (this.previous.cy - cy), 'touch');\n      }\n\n      this.previous = {\n        cx: cx,\n        cy: cy,\n        distance: distance\n      };\n    }\n  }, {\n    key: \"end\",\n    value: function end(e) {\n      this.previous = null;\n      this.pointers = this.pointers.filter(function (p) {\n        return p.pointerId !== e.pointerId;\n      });\n    }\n  }, {\n    key: \"dblclick\",\n    value: function dblclick(e) {\n      e.preventDefault();\n      var rect = this.el.getBoundingClientRect();\n      var delta = 4 * this.intensity;\n      var ox = (rect.left - e.clientX) * delta;\n      var oy = (rect.top - e.clientY) * delta;\n      this.onzoom(delta, ox, oy, 'dblclick');\n    }\n  }, {\n    key: \"translating\",\n    get: function get() {\n      // is translating while zoom (works on multitouch)\n      return this.pointers.length >= 2;\n    }\n  }]);\n\n  return Zoom;\n}();\n\nvar Area =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(Area, _Emitter);\n\n  function Area(container, emitter) {\n    var _this;\n\n    _classCallCheck(this, Area);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Area).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"container\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"transform\", {\n      k: 1,\n      x: 0,\n      y: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"mouse\", {\n      x: 0,\n      y: 0\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"_startPosition\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"_zoom\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_drag\", void 0);\n\n    var el = _this.el = document.createElement('div');\n    _this.container = container;\n    el.style.transformOrigin = '0 0';\n    _this._zoom = new Zoom(container, el, 0.1, _this.onZoom.bind(_assertThisInitialized(_this)));\n    _this._drag = new Drag(container, _this.onTranslate.bind(_assertThisInitialized(_this)), _this.onStart.bind(_assertThisInitialized(_this)));\n    emitter.on('destroy', function () {\n      _this._zoom.destroy();\n\n      _this._drag.destroy();\n    });\n\n    _this.container.addEventListener('pointermove', _this.pointermove.bind(_assertThisInitialized(_this)));\n\n    _this.update();\n\n    return _this;\n  }\n\n  _createClass(Area, [{\n    key: \"update\",\n    value: function update() {\n      var t = this.transform;\n      this.el.style.transform = \"translate(\".concat(t.x, \"px, \").concat(t.y, \"px) scale(\").concat(t.k, \")\");\n    }\n  }, {\n    key: \"pointermove\",\n    value: function pointermove(e) {\n      var clientX = e.clientX,\n          clientY = e.clientY;\n      var rect = this.el.getBoundingClientRect();\n      var x = clientX - rect.left;\n      var y = clientY - rect.top;\n      var k = this.transform.k;\n      this.mouse = {\n        x: x / k,\n        y: y / k\n      };\n      this.trigger('mousemove', _objectSpread({}, this.mouse)); // TODO rename on `pointermove`\n    }\n  }, {\n    key: \"onStart\",\n    value: function onStart() {\n      this._startPosition = _objectSpread({}, this.transform);\n    }\n  }, {\n    key: \"onTranslate\",\n    value: function onTranslate(dx, dy) {\n      if (this._zoom.translating) return; // lock translation while zoom on multitouch\n\n      if (this._startPosition) this.translate(this._startPosition.x + dx, this._startPosition.y + dy);\n    }\n  }, {\n    key: \"onZoom\",\n    value: function onZoom(delta, ox, oy, source) {\n      this.zoom(this.transform.k * (1 + delta), ox, oy, source);\n      this.update();\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(x, y) {\n      var params = {\n        transform: this.transform,\n        x: x,\n        y: y\n      };\n      if (!this.trigger('translate', params)) return;\n      this.transform.x = params.x;\n      this.transform.y = params.y;\n      this.update();\n      this.trigger('translated');\n    }\n  }, {\n    key: \"zoom\",\n    value: function zoom(_zoom) {\n      var ox = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var oy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var source = arguments.length > 3 ? arguments[3] : undefined;\n      var k = this.transform.k;\n      var params = {\n        transform: this.transform,\n        zoom: _zoom,\n        source: source\n      };\n      if (!this.trigger('zoom', params)) return;\n      var d = (k - params.zoom) / (k - _zoom || 1);\n      this.transform.k = params.zoom || 1;\n      this.transform.x += ox * d;\n      this.transform.y += oy * d;\n      this.update();\n      this.trigger('zoomed', {\n        source: source\n      });\n    }\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(el) {\n      this.el.appendChild(el);\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(el) {\n      this.el.removeChild(el);\n    }\n  }]);\n\n  return Area;\n}(Emitter);\n\nvar ConnectionView =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(ConnectionView, _Emitter);\n\n  function ConnectionView(connection, inputNode, outputNode, emitter) {\n    var _this;\n\n    _classCallCheck(this, ConnectionView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ConnectionView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"connection\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"inputNode\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"outputNode\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _this.connection = connection;\n    _this.inputNode = inputNode;\n    _this.outputNode = outputNode;\n    _this.el = document.createElement('div');\n    _this.el.style.position = 'absolute';\n    _this.el.style.zIndex = '-1';\n\n    _this.trigger('renderconnection', {\n      el: _this.el,\n      connection: _this.connection,\n      points: _this.getPoints()\n    });\n\n    return _this;\n  }\n\n  _createClass(ConnectionView, [{\n    key: \"getPoints\",\n    value: function getPoints() {\n      var _this$outputNode$getS = this.outputNode.getSocketPosition(this.connection.output),\n          _this$outputNode$getS2 = _slicedToArray(_this$outputNode$getS, 2),\n          x1 = _this$outputNode$getS2[0],\n          y1 = _this$outputNode$getS2[1];\n\n      var _this$inputNode$getSo = this.inputNode.getSocketPosition(this.connection.input),\n          _this$inputNode$getSo2 = _slicedToArray(_this$inputNode$getSo, 2),\n          x2 = _this$inputNode$getSo2[0],\n          y2 = _this$inputNode$getSo2[1];\n\n      return [x1, y1, x2, y2];\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      this.trigger('updateconnection', {\n        el: this.el,\n        connection: this.connection,\n        points: this.getPoints()\n      });\n    }\n  }]);\n\n  return ConnectionView;\n}(Emitter);\n\nvar ControlView =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(ControlView, _Emitter);\n\n  function ControlView(el, control, emitter) {\n    var _this;\n\n    _classCallCheck(this, ControlView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ControlView).call(this, emitter));\n\n    _this.trigger('rendercontrol', {\n      el: el,\n      control: control\n    });\n\n    return _this;\n  }\n\n  return ControlView;\n}(Emitter);\n\nvar SocketView =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(SocketView, _Emitter);\n\n  function SocketView(el, type, io, node, emitter) {\n    var _this$trigger;\n\n    var _this;\n\n    _classCallCheck(this, SocketView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SocketView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"type\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"io\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"node\", void 0);\n\n    _this.el = el;\n    _this.type = type;\n    _this.io = io;\n    _this.node = node;\n\n    _this.trigger('rendersocket', (_this$trigger = {\n      el: el\n    }, _defineProperty(_this$trigger, type, _this.io), _defineProperty(_this$trigger, \"socket\", io.socket), _this$trigger));\n\n    return _this;\n  }\n\n  _createClass(SocketView, [{\n    key: \"getPosition\",\n    value: function getPosition(_ref) {\n      var position = _ref.position;\n      var el = this.el;\n      return [position[0] + el.offsetLeft + el.offsetWidth / 2, position[1] + el.offsetTop + el.offsetHeight / 2];\n    }\n  }]);\n\n  return SocketView;\n}(Emitter);\n\nvar NodeView =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(NodeView, _Emitter);\n\n  function NodeView(node, component, emitter) {\n    var _this;\n\n    _classCallCheck(this, NodeView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NodeView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"node\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"component\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"sockets\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"controls\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"el\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"_startPosition\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"_drag\", void 0);\n\n    _this.node = node;\n    _this.component = component;\n    _this.el = document.createElement('div');\n    _this.el.style.position = 'absolute';\n\n    _this.el.addEventListener('contextmenu', function (e) {\n      return _this.trigger('contextmenu', {\n        e: e,\n        node: _this.node\n      });\n    });\n\n    _this._drag = new Drag(_this.el, _this.onTranslate.bind(_assertThisInitialized(_this)), _this.onSelect.bind(_assertThisInitialized(_this)), function () {\n      _this.trigger('nodedraged', node);\n\n      _this.trigger('nodedragged', node);\n    });\n\n    _this.trigger('rendernode', {\n      el: _this.el,\n      node: node,\n      component: component.data,\n      bindSocket: _this.bindSocket.bind(_assertThisInitialized(_this)),\n      bindControl: _this.bindControl.bind(_assertThisInitialized(_this))\n    });\n\n    _this.update();\n\n    return _this;\n  }\n\n  _createClass(NodeView, [{\n    key: \"clearSockets\",\n    value: function clearSockets() {\n      var _this2 = this;\n\n      var ios = [].concat(_toConsumableArray(this.node.inputs.values()), _toConsumableArray(this.node.outputs.values()));\n      this.sockets.forEach(function (s) {\n        if (!ios.includes(s.io)) _this2.sockets[\"delete\"](s.io);\n      });\n    }\n  }, {\n    key: \"bindSocket\",\n    value: function bindSocket(el, type, io) {\n      this.clearSockets();\n      this.sockets.set(io, new SocketView(el, type, io, this.node, this));\n    }\n  }, {\n    key: \"bindControl\",\n    value: function bindControl(el, control) {\n      this.controls.set(control, new ControlView(el, control, this));\n    }\n  }, {\n    key: \"getSocketPosition\",\n    value: function getSocketPosition(io) {\n      var socket = this.sockets.get(io);\n      if (!socket) throw new Error(\"Socket not found for \".concat(io.name, \" with key \").concat(io.key));\n      return socket.getPosition(this.node);\n    }\n  }, {\n    key: \"onSelect\",\n    value: function onSelect(e) {\n      var payload = {\n        node: this.node,\n        accumulate: e.ctrlKey,\n        e: e\n      };\n      this.onStart();\n      this.trigger('multiselectnode', payload);\n      this.trigger('selectnode', payload);\n    }\n  }, {\n    key: \"onStart\",\n    value: function onStart() {\n      this._startPosition = _toConsumableArray(this.node.position);\n    }\n  }, {\n    key: \"onTranslate\",\n    value: function onTranslate(dx, dy) {\n      this.trigger('translatenode', {\n        node: this.node,\n        dx: dx,\n        dy: dy\n      });\n    }\n  }, {\n    key: \"onDrag\",\n    value: function onDrag(dx, dy) {\n      var x = this._startPosition[0] + dx;\n      var y = this._startPosition[1] + dy;\n      this.translate(x, y);\n    }\n  }, {\n    key: \"translate\",\n    value: function translate(x, y) {\n      var node = this.node;\n      var params = {\n        node: node,\n        x: x,\n        y: y\n      };\n      if (!this.trigger('nodetranslate', params)) return;\n\n      var _node$position = _slicedToArray(node.position, 2),\n          px = _node$position[0],\n          py = _node$position[1];\n\n      var prev = [px, py];\n      node.position[0] = params.x;\n      node.position[1] = params.y;\n      this.update();\n      this.trigger('nodetranslated', {\n        node: node,\n        prev: prev\n      });\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var _this$node$position = _slicedToArray(this.node.position, 2),\n          x = _this$node$position[0],\n          y = _this$node$position[1];\n\n      this.el.style.transform = \"translate(\".concat(x, \"px, \").concat(y, \"px)\");\n    }\n  }, {\n    key: \"remove\",\n    value: function remove() {}\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._drag.destroy();\n    }\n  }]);\n\n  return NodeView;\n}(Emitter);\n\nvar EditorView =\n/*#__PURE__*/\nfunction (_Emitter) {\n  _inherits(EditorView, _Emitter);\n\n  function EditorView(container, components, emitter) {\n    var _this;\n\n    _classCallCheck(this, EditorView);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(EditorView).call(this, emitter));\n\n    _defineProperty(_assertThisInitialized(_this), \"container\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"components\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"nodes\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"connections\", new Map());\n\n    _defineProperty(_assertThisInitialized(_this), \"area\", void 0);\n\n    _this.container = container;\n    _this.components = components;\n    _this.container.style.overflow = 'hidden';\n\n    _this.container.addEventListener('click', _this.click.bind(_assertThisInitialized(_this)));\n\n    _this.container.addEventListener('contextmenu', function (e) {\n      return _this.trigger('contextmenu', {\n        e: e,\n        view: _assertThisInitialized(_this)\n      });\n    });\n\n    emitter.on('destroy', listenWindow('resize', _this.resize.bind(_assertThisInitialized(_this))));\n    emitter.on('destroy', function () {\n      return _this.nodes.forEach(function (view) {\n        return view.destroy();\n      });\n    });\n\n    _this.on('nodetranslated', _this.updateConnections.bind(_assertThisInitialized(_this)));\n\n    _this.area = new Area(container, _assertThisInitialized(_this));\n\n    _this.container.appendChild(_this.area.el);\n\n    return _this;\n  }\n\n  _createClass(EditorView, [{\n    key: \"addNode\",\n    value: function addNode(node) {\n      var component = this.components.get(node.name);\n      if (!component) throw new Error(\"Component \".concat(node.name, \" not found\"));\n      var nodeView = new NodeView(node, component, this);\n      this.nodes.set(node, nodeView);\n      this.area.appendChild(nodeView.el);\n    }\n  }, {\n    key: \"removeNode\",\n    value: function removeNode(node) {\n      var nodeView = this.nodes.get(node);\n      this.nodes[\"delete\"](node);\n\n      if (nodeView) {\n        this.area.removeChild(nodeView.el);\n        nodeView.destroy();\n      }\n    }\n  }, {\n    key: \"addConnection\",\n    value: function addConnection(connection) {\n      if (!connection.input.node || !connection.output.node) throw new Error('Connection input or output not added to node');\n      var viewInput = this.nodes.get(connection.input.node);\n      var viewOutput = this.nodes.get(connection.output.node);\n      if (!viewInput || !viewOutput) throw new Error('View node not found for input or output');\n      var connView = new ConnectionView(connection, viewInput, viewOutput, this);\n      this.connections.set(connection, connView);\n      this.area.appendChild(connView.el);\n    }\n  }, {\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      var connView = this.connections.get(connection);\n      this.connections[\"delete\"](connection);\n      if (connView) this.area.removeChild(connView.el);\n    }\n  }, {\n    key: \"updateConnections\",\n    value: function updateConnections(_ref) {\n      var _this2 = this;\n\n      var node = _ref.node;\n      node.getConnections().forEach(function (conn) {\n        var connView = _this2.connections.get(conn);\n\n        if (!connView) throw new Error('Connection view not found');\n        connView.update();\n      });\n    }\n  }, {\n    key: \"resize\",\n    value: function resize() {\n      var container = this.container;\n      if (!container.parentElement) throw new Error('Container doesn\\'t have parent element');\n      var width = container.parentElement.clientWidth;\n      var height = container.parentElement.clientHeight;\n      container.style.width = width + 'px';\n      container.style.height = height + 'px';\n    }\n  }, {\n    key: \"click\",\n    value: function click(e) {\n      var container = this.container;\n      if (container !== e.target) return;\n      if (!this.trigger('click', {\n        e: e,\n        container: container\n      })) return;\n    }\n  }]);\n\n  return EditorView;\n}(Emitter);\n\nvar Selected =\n/*#__PURE__*/\nfunction () {\n  function Selected() {\n    _classCallCheck(this, Selected);\n\n    _defineProperty(this, \"list\", []);\n  }\n\n  _createClass(Selected, [{\n    key: \"add\",\n    value: function add(item) {\n      var accumulate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!accumulate) this.list = [item];else if (!this.contains(item)) this.list.push(item);\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      this.list = [];\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(item) {\n      this.list.splice(this.list.indexOf(item), 1);\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(item) {\n      return this.list.indexOf(item) !== -1;\n    }\n  }, {\n    key: \"each\",\n    value: function each(callback) {\n      this.list.forEach(callback);\n    }\n  }]);\n\n  return Selected;\n}();\n\nvar Events = function Events(handlers) {\n  _classCallCheck(this, Events);\n\n  _defineProperty(this, \"handlers\", void 0);\n\n  this.handlers = _objectSpread({\n    warn: [console.warn],\n    error: [console.error],\n    componentregister: [],\n    destroy: []\n  }, handlers);\n};\n\nvar EditorEvents =\n/*#__PURE__*/\nfunction (_Events) {\n  _inherits(EditorEvents, _Events);\n\n  function EditorEvents() {\n    _classCallCheck(this, EditorEvents);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EditorEvents).call(this, {\n      nodecreate: [],\n      nodecreated: [],\n      noderemove: [],\n      noderemoved: [],\n      connectioncreate: [],\n      connectioncreated: [],\n      connectionremove: [],\n      connectionremoved: [],\n      translatenode: [],\n      nodetranslate: [],\n      nodetranslated: [],\n      nodedraged: [],\n      nodedragged: [],\n      selectnode: [],\n      multiselectnode: [],\n      nodeselect: [],\n      nodeselected: [],\n      rendernode: [],\n      rendersocket: [],\n      rendercontrol: [],\n      renderconnection: [],\n      updateconnection: [],\n      keydown: [],\n      keyup: [],\n      translate: [],\n      translated: [],\n      zoom: [],\n      zoomed: [],\n      click: [],\n      mousemove: [],\n      contextmenu: [],\n      \"import\": [],\n      \"export\": [],\n      process: [],\n      clear: []\n    }));\n  }\n\n  return EditorEvents;\n}(Events);\n\nvar NodeEditor =\n/*#__PURE__*/\nfunction (_Context) {\n  _inherits(NodeEditor, _Context);\n\n  function NodeEditor(id, container) {\n    var _this;\n\n    _classCallCheck(this, NodeEditor);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NodeEditor).call(this, id, new EditorEvents()));\n\n    _defineProperty(_assertThisInitialized(_this), \"nodes\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"selected\", new Selected());\n\n    _defineProperty(_assertThisInitialized(_this), \"view\", void 0);\n\n    _this.view = new EditorView(container, _this.components, _assertThisInitialized(_this));\n\n    _this.on('destroy', listenWindow('keydown', function (e) {\n      return _this.trigger('keydown', e);\n    }));\n\n    _this.on('destroy', listenWindow('keyup', function (e) {\n      return _this.trigger('keyup', e);\n    }));\n\n    _this.on('selectnode', function (_ref) {\n      var node = _ref.node,\n          accumulate = _ref.accumulate;\n      return _this.selectNode(node, accumulate);\n    });\n\n    _this.on('nodeselected', function () {\n      return _this.selected.each(function (n) {\n        var nodeView = _this.view.nodes.get(n);\n\n        nodeView && nodeView.onStart();\n      });\n    });\n\n    _this.on('translatenode', function (_ref2) {\n      var dx = _ref2.dx,\n          dy = _ref2.dy;\n      return _this.selected.each(function (n) {\n        var nodeView = _this.view.nodes.get(n);\n\n        nodeView && nodeView.onDrag(dx, dy);\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(NodeEditor, [{\n    key: \"addNode\",\n    value: function addNode(node) {\n      if (!this.trigger('nodecreate', node)) return;\n      this.nodes.push(node);\n      this.view.addNode(node);\n      this.trigger('nodecreated', node);\n    }\n  }, {\n    key: \"removeNode\",\n    value: function removeNode(node) {\n      var _this2 = this;\n\n      if (!this.trigger('noderemove', node)) return;\n      node.getConnections().forEach(function (c) {\n        return _this2.removeConnection(c);\n      });\n      this.nodes.splice(this.nodes.indexOf(node), 1);\n      this.view.removeNode(node);\n      this.trigger('noderemoved', node);\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(output, input) {\n      var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      if (!this.trigger('connectioncreate', {\n        output: output,\n        input: input\n      })) return;\n\n      try {\n        var connection = output.connectTo(input);\n        connection.data = data;\n        this.view.addConnection(connection);\n        this.trigger('connectioncreated', connection);\n      } catch (e) {\n        this.trigger('warn', e);\n      }\n    }\n  }, {\n    key: \"removeConnection\",\n    value: function removeConnection(connection) {\n      if (!this.trigger('connectionremove', connection)) return;\n      this.view.removeConnection(connection);\n      connection.remove();\n      this.trigger('connectionremoved', connection);\n    }\n  }, {\n    key: \"selectNode\",\n    value: function selectNode(node) {\n      var accumulate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (this.nodes.indexOf(node) === -1) throw new Error('Node not exist in list');\n      if (!this.trigger('nodeselect', node)) return;\n      this.selected.add(node, accumulate);\n      this.trigger('nodeselected', node);\n    }\n  }, {\n    key: \"getComponent\",\n    value: function getComponent(name) {\n      var component = this.components.get(name);\n      if (!component) throw \"Component \".concat(name, \" not found\");\n      return component;\n    }\n  }, {\n    key: \"register\",\n    value: function register(component) {\n      _get(_getPrototypeOf(NodeEditor.prototype), \"register\", this).call(this, component);\n\n      component.editor = this;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var _this3 = this;\n\n      _toConsumableArray(this.nodes).forEach(function (node) {\n        return _this3.removeNode(node);\n      });\n\n      this.trigger('clear');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      var data = {\n        id: this.id,\n        nodes: {}\n      };\n      this.nodes.forEach(function (node) {\n        return data.nodes[node.id] = node.toJSON();\n      });\n      this.trigger('export', data);\n      return data;\n    }\n  }, {\n    key: \"beforeImport\",\n    value: function beforeImport(json) {\n      var checking = Validator.validate(this.id, json);\n\n      if (!checking.success) {\n        this.trigger('warn', checking.msg);\n        return false;\n      }\n\n      this.silent = true;\n      this.clear();\n      this.trigger('import', json);\n      return true;\n    }\n  }, {\n    key: \"afterImport\",\n    value: function afterImport() {\n      this.silent = false;\n      return true;\n    }\n  }, {\n    key: \"fromJSON\",\n    value: function () {\n      var _fromJSON = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(json) {\n        var _this4 = this;\n\n        var nodes;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.beforeImport(json)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", false);\n\n              case 2:\n                nodes = {};\n                _context2.prev = 3;\n                _context2.next = 6;\n                return Promise.all(Object.keys(json.nodes).map(\n                /*#__PURE__*/\n                function () {\n                  var _ref3 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  regeneratorRuntime.mark(function _callee(id) {\n                    var node, component;\n                    return regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            node = json.nodes[id];\n                            component = _this4.getComponent(node.name);\n                            _context.next = 4;\n                            return component.build(Node.fromJSON(node));\n\n                          case 4:\n                            nodes[id] = _context.sent;\n\n                            _this4.addNode(nodes[id]);\n\n                          case 6:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  return function (_x2) {\n                    return _ref3.apply(this, arguments);\n                  };\n                }()));\n\n              case 6:\n                Object.keys(json.nodes).forEach(function (id) {\n                  var jsonNode = json.nodes[id];\n                  var node = nodes[id];\n                  Object.keys(jsonNode.outputs).forEach(function (key) {\n                    var outputJson = jsonNode.outputs[key];\n                    outputJson.connections.forEach(function (jsonConnection) {\n                      var nodeId = jsonConnection.node;\n                      var data = jsonConnection.data;\n                      var targetOutput = node.outputs.get(key);\n                      var targetInput = nodes[nodeId].inputs.get(jsonConnection.input);\n\n                      if (!targetOutput || !targetInput) {\n                        return _this4.trigger('error', \"IO not found for node \".concat(node.id));\n                      }\n\n                      _this4.connect(targetOutput, targetInput, data);\n                    });\n                  });\n                });\n                _context2.next = 13;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](3);\n                this.trigger('warn', _context2.t0);\n                return _context2.abrupt(\"return\", !this.afterImport());\n\n              case 13:\n                return _context2.abrupt(\"return\", this.afterImport());\n\n              case 14:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[3, 9]]);\n      }));\n\n      function fromJSON(_x) {\n        return _fromJSON.apply(this, arguments);\n      }\n\n      return fromJSON;\n    }()\n  }]);\n\n  return NodeEditor;\n}(Context);\n\nvar Output =\n/*#__PURE__*/\nfunction (_IO) {\n  _inherits(Output, _IO);\n\n  function Output(key, title, socket) {\n    var multiConns = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n\n    _classCallCheck(this, Output);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Output).call(this, key, title, socket, multiConns));\n  }\n\n  _createClass(Output, [{\n    key: \"hasConnection\",\n    value: function hasConnection() {\n      return this.connections.length > 0;\n    }\n  }, {\n    key: \"connectTo\",\n    value: function connectTo(input) {\n      if (!this.socket.compatibleWith(input.socket)) throw new Error('Sockets not compatible');\n      if (!input.multipleConnections && input.hasConnection()) throw new Error('Input already has one connection');\n      if (!this.multipleConnections && this.hasConnection()) throw new Error('Output already has one connection');\n      var connection = new Connection(this, input);\n      this.connections.push(connection);\n      return connection;\n    }\n  }, {\n    key: \"connectedTo\",\n    value: function connectedTo(input) {\n      return this.connections.some(function (item) {\n        return item.input === input;\n      });\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        'connections': this.connections.map(function (c) {\n          if (!c.input.node) throw new Error('Node not added to Input');\n          return {\n            node: c.input.node.id,\n            input: c.input.key,\n            data: c.data\n          };\n        })\n      };\n    }\n  }]);\n\n  return Output;\n}(IO);\n\nvar Socket =\n/*#__PURE__*/\nfunction () {\n  function Socket(name) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, Socket);\n\n    _defineProperty(this, \"name\", void 0);\n\n    _defineProperty(this, \"data\", void 0);\n\n    _defineProperty(this, \"compatible\", []);\n\n    this.name = name;\n    this.data = data;\n    this.compatible = [];\n  }\n\n  _createClass(Socket, [{\n    key: \"combineWith\",\n    value: function combineWith(socket) {\n      this.compatible.push(socket);\n    }\n  }, {\n    key: \"compatibleWith\",\n    value: function compatibleWith(socket) {\n      return this === socket || this.compatible.includes(socket);\n    }\n  }]);\n\n  return Socket;\n}();\n\nfunction intersect(array1, array2) {\n  return array1.filter(function (value) {\n    return -1 !== array2.indexOf(value);\n  });\n}\n\nvar Recursion =\n/*#__PURE__*/\nfunction () {\n  function Recursion(nodes) {\n    _classCallCheck(this, Recursion);\n\n    _defineProperty(this, \"nodes\", void 0);\n\n    this.nodes = nodes;\n  }\n\n  _createClass(Recursion, [{\n    key: \"extractInputNodes\",\n    value: function extractInputNodes(node) {\n      var _this = this;\n\n      return Object.keys(node.inputs).reduce(function (acc, key) {\n        var connections = node.inputs[key].connections;\n        var nodesData = (connections || []).reduce(function (b, c) {\n          return [].concat(_toConsumableArray(b), [_this.nodes[c.node]]);\n        }, []);\n        return [].concat(_toConsumableArray(acc), _toConsumableArray(nodesData));\n      }, []);\n    }\n  }, {\n    key: \"findSelf\",\n    value: function findSelf(list, inputNodes) {\n      var inters = intersect(list, inputNodes);\n      if (inters.length) return inters[0];\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = inputNodes[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var node = _step.value;\n          var l = [node].concat(_toConsumableArray(list));\n          var inter = this.findSelf(l, this.extractInputNodes(node));\n          if (inter) return inter;\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"detect\",\n    value: function detect() {\n      var _this2 = this;\n\n      var nodesArr = Object.keys(this.nodes).map(function (id) {\n        return _this2.nodes[id];\n      });\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = nodesArr[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var node = _step2.value;\n          var inters = this.findSelf([node], this.extractInputNodes(node));\n          if (inters) return inters;\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n            _iterator2[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return Recursion;\n}();\n\nvar State = {\n  AVAILABLE: 0,\n  PROCESSED: 1,\n  ABORT: 2\n};\n\nvar EngineEvents =\n/*#__PURE__*/\nfunction (_Events) {\n  _inherits(EngineEvents, _Events);\n\n  function EngineEvents() {\n    _classCallCheck(this, EngineEvents);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(EngineEvents).call(this, {}));\n  }\n\n  return EngineEvents;\n}(Events);\n\nvar Engine =\n/*#__PURE__*/\nfunction (_Context) {\n  _inherits(Engine, _Context);\n\n  function Engine(id) {\n    var _this;\n\n    _classCallCheck(this, Engine);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Engine).call(this, id, new EngineEvents()));\n\n    _defineProperty(_assertThisInitialized(_this), \"args\", []);\n\n    _defineProperty(_assertThisInitialized(_this), \"data\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", State.AVAILABLE);\n\n    _defineProperty(_assertThisInitialized(_this), \"forwarded\", new Set());\n\n    _defineProperty(_assertThisInitialized(_this), \"onAbort\", function () {});\n\n    return _this;\n  }\n\n  _createClass(Engine, [{\n    key: \"clone\",\n    value: function clone() {\n      var engine = new Engine(this.id);\n      this.components.forEach(function (c) {\n        return engine.register(c);\n      });\n      return engine;\n    }\n  }, {\n    key: \"throwError\",\n    value: function () {\n      var _throwError = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(message) {\n        var data,\n            _args = arguments;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = _args.length > 1 && _args[1] !== undefined ? _args[1] : null;\n                _context.next = 3;\n                return this.abort();\n\n              case 3:\n                this.trigger('error', {\n                  message: message,\n                  data: data\n                });\n                this.processDone();\n                return _context.abrupt(\"return\", 'error');\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function throwError(_x) {\n        return _throwError.apply(this, arguments);\n      }\n\n      return throwError;\n    }()\n  }, {\n    key: \"processStart\",\n    value: function processStart() {\n      if (this.state === State.AVAILABLE) {\n        this.state = State.PROCESSED;\n        return true;\n      }\n\n      if (this.state === State.ABORT) {\n        return false;\n      }\n\n      console.warn(\"The process is busy and has not been restarted.\\n                Use abort() to force it to complete\");\n      return false;\n    }\n  }, {\n    key: \"processDone\",\n    value: function processDone() {\n      var success = this.state !== State.ABORT;\n      this.state = State.AVAILABLE;\n\n      if (!success) {\n        this.onAbort();\n\n        this.onAbort = function () {};\n      }\n\n      return success;\n    }\n  }, {\n    key: \"abort\",\n    value: function () {\n      var _abort = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _this2 = this;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", new Promise(function (ret) {\n                  if (_this2.state === State.PROCESSED) {\n                    _this2.state = State.ABORT;\n                    _this2.onAbort = ret;\n                  } else if (_this2.state === State.ABORT) {\n                    _this2.onAbort();\n\n                    _this2.onAbort = ret;\n                  } else ret();\n                }));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function abort() {\n        return _abort.apply(this, arguments);\n      }\n\n      return abort;\n    }()\n  }, {\n    key: \"lock\",\n    value: function () {\n      var _lock = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(node) {\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", new Promise(function (res) {\n                  node.unlockPool = node.unlockPool || [];\n                  if (node.busy && !node.outputData) node.unlockPool.push(res);else res();\n                  node.busy = true;\n                }));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function lock(_x2) {\n        return _lock.apply(this, arguments);\n      }\n\n      return lock;\n    }()\n  }, {\n    key: \"unlock\",\n    value: function unlock(node) {\n      node.unlockPool.forEach(function (a) {\n        return a();\n      });\n      node.unlockPool = [];\n      node.busy = false;\n    }\n  }, {\n    key: \"extractInputData\",\n    value: function () {\n      var _extractInputData = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5(node) {\n        var _this3 = this;\n\n        var obj, _i, _Object$keys, key, input, conns, connData;\n\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                obj = {};\n                _i = 0, _Object$keys = Object.keys(node.inputs);\n\n              case 2:\n                if (!(_i < _Object$keys.length)) {\n                  _context5.next = 13;\n                  break;\n                }\n\n                key = _Object$keys[_i];\n                input = node.inputs[key];\n                conns = input.connections;\n                _context5.next = 8;\n                return Promise.all(conns.map(\n                /*#__PURE__*/\n                function () {\n                  var _ref = _asyncToGenerator(\n                  /*#__PURE__*/\n                  regeneratorRuntime.mark(function _callee4(c) {\n                    var prevNode, outputs;\n                    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            prevNode = _this3.data.nodes[c.node];\n                            _context4.next = 3;\n                            return _this3.processNode(prevNode);\n\n                          case 3:\n                            outputs = _context4.sent;\n\n                            if (outputs) {\n                              _context4.next = 8;\n                              break;\n                            }\n\n                            _this3.abort();\n\n                            _context4.next = 9;\n                            break;\n\n                          case 8:\n                            return _context4.abrupt(\"return\", outputs[c.output]);\n\n                          case 9:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  }));\n\n                  return function (_x4) {\n                    return _ref.apply(this, arguments);\n                  };\n                }()));\n\n              case 8:\n                connData = _context5.sent;\n                obj[key] = connData;\n\n              case 10:\n                _i++;\n                _context5.next = 2;\n                break;\n\n              case 13:\n                return _context5.abrupt(\"return\", obj);\n\n              case 14:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function extractInputData(_x3) {\n        return _extractInputData.apply(this, arguments);\n      }\n\n      return extractInputData;\n    }()\n  }, {\n    key: \"processWorker\",\n    value: function () {\n      var _processWorker = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee6(node) {\n        var inputData, component, outputData;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.extractInputData(node);\n\n              case 2:\n                inputData = _context6.sent;\n                component = this.components.get(node.name);\n                outputData = {};\n                _context6.prev = 5;\n                _context6.next = 8;\n                return component.worker.apply(component, [node, inputData, outputData].concat(_toConsumableArray(this.args)));\n\n              case 8:\n                _context6.next = 14;\n                break;\n\n              case 10:\n                _context6.prev = 10;\n                _context6.t0 = _context6[\"catch\"](5);\n                this.abort();\n                this.trigger('warn', _context6.t0);\n\n              case 14:\n                return _context6.abrupt(\"return\", outputData);\n\n              case 15:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this, [[5, 10]]);\n      }));\n\n      function processWorker(_x5) {\n        return _processWorker.apply(this, arguments);\n      }\n\n      return processWorker;\n    }()\n  }, {\n    key: \"processNode\",\n    value: function () {\n      var _processNode = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee7(node) {\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!(this.state === State.ABORT || !node)) {\n                  _context7.next = 2;\n                  break;\n                }\n\n                return _context7.abrupt(\"return\", null);\n\n              case 2:\n                _context7.next = 4;\n                return this.lock(node);\n\n              case 4:\n                if (node.outputData) {\n                  _context7.next = 8;\n                  break;\n                }\n\n                _context7.next = 7;\n                return this.processWorker(node);\n\n              case 7:\n                node.outputData = _context7.sent;\n\n              case 8:\n                this.unlock(node);\n                return _context7.abrupt(\"return\", node.outputData);\n\n              case 10:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function processNode(_x6) {\n        return _processNode.apply(this, arguments);\n      }\n\n      return processNode;\n    }()\n  }, {\n    key: \"forwardProcess\",\n    value: function () {\n      var _forwardProcess = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee10(node) {\n        var _this4 = this;\n\n        return regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                if (!(this.state === State.ABORT)) {\n                  _context10.next = 2;\n                  break;\n                }\n\n                return _context10.abrupt(\"return\", null);\n\n              case 2:\n                _context10.next = 4;\n                return Promise.all(Object.keys(node.outputs).map(\n                /*#__PURE__*/\n                function () {\n                  var _ref2 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  regeneratorRuntime.mark(function _callee9(key) {\n                    var output;\n                    return regeneratorRuntime.wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            output = node.outputs[key];\n                            _context9.next = 3;\n                            return Promise.all(output.connections.map(\n                            /*#__PURE__*/\n                            function () {\n                              var _ref3 = _asyncToGenerator(\n                              /*#__PURE__*/\n                              regeneratorRuntime.mark(function _callee8(c) {\n                                var nextNode;\n                                return regeneratorRuntime.wrap(function _callee8$(_context8) {\n                                  while (1) {\n                                    switch (_context8.prev = _context8.next) {\n                                      case 0:\n                                        nextNode = _this4.data.nodes[c.node];\n\n                                        if (_this4.forwarded.has(nextNode)) {\n                                          _context8.next = 7;\n                                          break;\n                                        }\n\n                                        _this4.forwarded.add(nextNode);\n\n                                        _context8.next = 5;\n                                        return _this4.processNode(nextNode);\n\n                                      case 5:\n                                        _context8.next = 7;\n                                        return _this4.forwardProcess(nextNode);\n\n                                      case 7:\n                                      case \"end\":\n                                        return _context8.stop();\n                                    }\n                                  }\n                                }, _callee8);\n                              }));\n\n                              return function (_x9) {\n                                return _ref3.apply(this, arguments);\n                              };\n                            }()));\n\n                          case 3:\n                            return _context9.abrupt(\"return\", _context9.sent);\n\n                          case 4:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n\n                  return function (_x8) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }()));\n\n              case 4:\n                return _context10.abrupt(\"return\", _context10.sent);\n\n              case 5:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function forwardProcess(_x7) {\n        return _forwardProcess.apply(this, arguments);\n      }\n\n      return forwardProcess;\n    }()\n  }, {\n    key: \"copy\",\n    value: function copy(data) {\n      data = Object.assign({}, data);\n      data.nodes = Object.assign({}, data.nodes);\n      Object.keys(data.nodes).forEach(function (key) {\n        data.nodes[key] = Object.assign({}, data.nodes[key]);\n      });\n      return data;\n    }\n  }, {\n    key: \"validate\",\n    value: function () {\n      var _validate = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee11(data) {\n        var checking, recursion, recurrentNode;\n        return regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                checking = Validator.validate(this.id, data);\n                recursion = new Recursion(data.nodes);\n\n                if (checking.success) {\n                  _context11.next = 6;\n                  break;\n                }\n\n                _context11.next = 5;\n                return this.throwError(checking.msg);\n\n              case 5:\n                return _context11.abrupt(\"return\", _context11.sent);\n\n              case 6:\n                recurrentNode = recursion.detect();\n\n                if (!recurrentNode) {\n                  _context11.next = 11;\n                  break;\n                }\n\n                _context11.next = 10;\n                return this.throwError('Recursion detected', recurrentNode);\n\n              case 10:\n                return _context11.abrupt(\"return\", _context11.sent);\n\n              case 11:\n                return _context11.abrupt(\"return\", true);\n\n              case 12:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n\n      function validate(_x10) {\n        return _validate.apply(this, arguments);\n      }\n\n      return validate;\n    }()\n  }, {\n    key: \"processStartNode\",\n    value: function () {\n      var _processStartNode = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee12(id) {\n        var startNode;\n        return regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (id) {\n                  _context12.next = 2;\n                  break;\n                }\n\n                return _context12.abrupt(\"return\");\n\n              case 2:\n                startNode = this.data.nodes[id];\n\n                if (startNode) {\n                  _context12.next = 7;\n                  break;\n                }\n\n                _context12.next = 6;\n                return this.throwError('Node with such id not found');\n\n              case 6:\n                return _context12.abrupt(\"return\", _context12.sent);\n\n              case 7:\n                _context12.next = 9;\n                return this.processNode(startNode);\n\n              case 9:\n                _context12.next = 11;\n                return this.forwardProcess(startNode);\n\n              case 11:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function processStartNode(_x11) {\n        return _processStartNode.apply(this, arguments);\n      }\n\n      return processStartNode;\n    }()\n  }, {\n    key: \"processUnreachable\",\n    value: function () {\n      var _processUnreachable = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee13() {\n        var data, i, node;\n        return regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                data = this.data;\n                _context13.t0 = regeneratorRuntime.keys(data.nodes);\n\n              case 2:\n                if ((_context13.t1 = _context13.t0()).done) {\n                  _context13.next = 12;\n                  break;\n                }\n\n                i = _context13.t1.value;\n                // process nodes that have not been reached\n                node = data.nodes[i];\n\n                if (!(typeof node.outputData === 'undefined')) {\n                  _context13.next = 10;\n                  break;\n                }\n\n                _context13.next = 8;\n                return this.processNode(node);\n\n              case 8:\n                _context13.next = 10;\n                return this.forwardProcess(node);\n\n              case 10:\n                _context13.next = 2;\n                break;\n\n              case 12:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function processUnreachable() {\n        return _processUnreachable.apply(this, arguments);\n      }\n\n      return processUnreachable;\n    }()\n  }, {\n    key: \"process\",\n    value: function () {\n      var _process = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee14(data) {\n        var startId,\n            _len,\n            args,\n            _key,\n            _args14 = arguments;\n\n        return regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                startId = _args14.length > 1 && _args14[1] !== undefined ? _args14[1] : null;\n\n                if (this.processStart()) {\n                  _context14.next = 3;\n                  break;\n                }\n\n                return _context14.abrupt(\"return\");\n\n              case 3:\n                if (this.validate(data)) {\n                  _context14.next = 5;\n                  break;\n                }\n\n                return _context14.abrupt(\"return\");\n\n              case 5:\n                this.data = this.copy(data);\n\n                for (_len = _args14.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n                  args[_key - 2] = _args14[_key];\n                }\n\n                this.args = args;\n                this.forwarded = new Set();\n                _context14.next = 11;\n                return this.processStartNode(startId);\n\n              case 11:\n                _context14.next = 13;\n                return this.processUnreachable();\n\n              case 13:\n                return _context14.abrupt(\"return\", this.processDone() ? 'success' : 'aborted');\n\n              case 14:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function process(_x12) {\n        return _process.apply(this, arguments);\n      }\n\n      return process;\n    }()\n  }]);\n\n  return Engine;\n}(Context);\n\nvar index = {\n  Engine: Engine,\n  Recursion: Recursion,\n  Component: Component$1,\n  Control: Control,\n  Connection: Connection,\n  Emitter: Emitter,\n  Input: Input,\n  IO: IO,\n  Node: Node,\n  NodeEditor: NodeEditor,\n  Output: Output,\n  Socket: Socket\n};\n\nexport default index;\nexport { Component$1 as Component, Connection, Control, Emitter, Engine, IO, Input, Node, NodeEditor, Output, Recursion, Socket };\n"]},"metadata":{},"sourceType":"module"}